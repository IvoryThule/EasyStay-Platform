import{v as e,x as a,u as c,V as s,I as l,T as n,A as r,o as t,p as i,t as o,g as u,U as d,F as h,C as m,y as x,S as p,G as v,O as j,_ as f,P as N,s as y,J as g,b as k,N as b,c as w,K as T,Y as _,Q as C}from"./vendors.8928da7e.js";import{r as S}from"./common.0834f2a9.js";var D=function(o){var u,d=o.data,h=o.onClick,m=e.useState(""),x=a(m,2),p=x[0],v=x[1],j=e.useState(!1),f=a(j,2),N=f[0],y=f[1];return e.useEffect(function(){if(d.aiRecommendation)v(d.aiRecommendation);else{var e=function(){var e=t(i().m(function e(){var a,c;return i().w(function(e){while(1)switch(e.p=e.n){case 0:if(d.name&&d.city){e.n=1;break}return e.a(2);case 1:return y(!0),e.p=2,e.n=3,S({url:"/ai/generate-slogan",method:"POST",data:{hotelName:d.name,city:d.city,tags:d.tags||[]}});case 3:a=e.v,200===a.code&&a.data&&a.data.slogan&&v(a.data.slogan),e.n=5;break;case 4:e.p=4,c=e.v,console.error("\u83b7\u53d6AI\u63a8\u8350\u8bed\u5931\u8d25:",c);case 5:return e.p=5,y(!1),e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])}));return function(){return e.apply(this,arguments)}}();e()}},[d.id,d.name,d.city,d.tags,d.aiRecommendation]),d?c.jsxs(s,{className:"hotel-card",onClick:h,children:[c.jsxs(s,{className:"hotel-card__media",children:[c.jsx(l,{src:d.imageUrl,className:"hotel-card__img",mode:"aspectFill"}),c.jsx(s,{className:"video-badge",children:c.jsx(n,{className:"icon",children:"\u25b6"})})]}),c.jsxs(s,{className:"hotel-card__content",children:[c.jsxs(s,{children:[c.jsxs(s,{className:"hotel-card__title-row",children:[c.jsx(n,{className:"hotel-card__name",children:d.name}),c.jsx(n,{className:"hotel-card__diamonds",children:" \u25cf\u25cf\u25cf\u25cf\u25cf"})]}),d.score&&c.jsxs(s,{className:"hotel-card__stats",children:[c.jsxs(s,{className:"score-badge",children:[c.jsx(n,{className:"score-num",children:d.score}),c.jsx(n,{className:"score-text",children:d.scoreDesc||"\u597d\u8bc4"})]}),d.commentCount>0&&c.jsxs(n,{className:"comment-text",children:[d.commentCount,"\u70b9\u8bc4",d.collectionCount?" \xb7 ".concat(Math.floor(d.collectionCount/1e4),"\u4e07\u6536\u85cf"):""]})]}),c.jsx(n,{className:"hotel-card__location",children:d.locationDesc}),(p||N)&&c.jsx(s,{className:"hotel-card__highlight",children:c.jsx(n,{className:"highlight-content",children:N?"AI\u6b63\u5728\u751f\u6210\u63a8\u8350\u8bed...":"AI\u63a8\u8350: ".concat(p)})}),c.jsx(s,{className:"hotel-card__tags",children:d.tags&&r(u=d.tags).call(u,function(e,a){return c.jsx(s,{className:"tag-item ".concat(0===a?"tag-blue":""),children:c.jsx(n,{className:"tag-text",children:e})},a)})}),d.ranking&&c.jsxs(s,{className:"hotel-card__ranking",children:[c.jsx(n,{className:"rank-icon",children:"\ud83c\udfc6"}),c.jsx(n,{className:"rank-text",children:d.ranking.text})]})]}),c.jsxs(s,{className:"hotel-card__footer",children:[c.jsx(n,{className:"promo-text",children:"\u94bb\u77f3\u8d35\u5bbe\u4ef7 >"}),c.jsxs(s,{className:"price-box",children:[c.jsx(n,{className:"currency",children:"\xa5"}),c.jsx(n,{className:"price",children:d.price}),c.jsx(n,{className:"suffix",children:"\u8d77"})]})]})]})]}):null};const I=D;var O="http://1.14.207.212:8848",A=[{label:"\u4e0d\u9650",value:"all"},{label:"\xa50-150",value:"0-150"},{label:"\xa5150-300",value:"150-300"},{label:"\xa5300-600",value:"300-600"},{label:"\xa5600+",value:"600-up"}],M=[{label:"\u4e0d\u9650",value:"all"},{label:"\u4e8c\u661f/\u7ecf\u6d4e",value:"2"},{label:"\u4e09\u661f/\u8212\u9002",value:"3"},{label:"\u56db\u661f/\u9ad8\u6863",value:"4"},{label:"\u4e94\u661f/\u8c6a\u534e",value:"5"}];function R(){var l,D=e.useState([]),R=a(D,2),E=R[0],P=R[1],G=e.useState(!1),J=a(G,2),U=J[0],Y=J[1],$=e.useState(1),B=a($,2),F=B[0],L=B[1],q=e.useState(!0),z=a(q,2),H=z[0],K=z[1],Q=e.useState({city:"",checkInDate:"",checkOutDate:"",keyword:"",priceType:"all",starType:"all"}),V=a(Q,2),W=V[0],X=V[1],Z=e.useState(!1),ee=a(Z,2),ae=ee[0],ce=ee[1],se=e.useState({price:"all",star:"all"}),le=a(se,2),ne=le[0],re=le[1],te=e.useState(!1),ie=a(te,2),oe=ie[0],ue=ie[1],de=function(e){var a={"0-150":{min:0,max:150},"150-300":{min:150,max:300},"300-600":{min:300,max:600},"600-up":{min:600,max:99999}};return a[e]||{min:void 0,max:void 0}},he=e.useRef(!1),me=e.useRef("");o.useLoad(function(){console.log("\u5217\u8868\u9875\u52a0\u8f7d\uff08\u4ec5\u5728\u9875\u9762\u9500\u6bc1\u540e\u91cd\u65b0\u8fdb\u5165\u65f6\u89e6\u53d1\uff09")}),o.useDidShow(function(){console.log("\u5217\u8868\u9875\u663e\u793a\uff08\u6bcf\u6b21\u5207\u56de\u6216\u8fdb\u5165\u8be5\u9875\u90fd\u4f1a\u89e6\u53d1\uff09");var e=u("hotelSearchParams")||{},a=d(e);(!he.current||a&&a!==me.current)&&(he.current=!0,me.current=a,xe(e))});var xe=function(e){var a,c=e||u("hotelSearchParams")||{};console.log("\u3010\u68c0\u6d4b\u7f13\u5b58\u540c\u6b65\u3011:",c);var s=h(a=String(c.city||"").replace(/\u5e02$/,"")).call(a),l={city:s,checkInDate:(null===c||void 0===c?void 0:c.checkInDate)||"",checkOutDate:(null===c||void 0===c?void 0:c.checkOutDate)||"",keyword:(null===c||void 0===c?void 0:c.keyword)||"",priceType:(null===c||void 0===c?void 0:c.priceType)||"all",starType:(null===c||void 0===c?void 0:c.starType)||"all"};X(l),re({price:l.priceType,star:l.starType}),De([]),K(!0),L(1),P([]),pe(l,1,Ge,[])},pe=function(){var e=t(i().m(function e(a){var c,s,l,n,t,o,u,d,m,p,j,N,_,D,I,A,M,R,E,G,J,$,B,F,L,q,z=arguments;return i().w(function(e){while(1)switch(e.p=e.n){case 0:if(u=z.length>1&&void 0!==z[1]?z[1]:1,d=z.length>2&&void 0!==z[2]?z[2]:Ge,m=z.length>3&&void 0!==z[3]?z[3]:Se,p=z.length>4&&void 0!==z[4]&&z[4],!U){e.n=1;break}return e.a(2);case 1:return Y(!0),j=de(a.priceType),N=j.min,_=j.max,D=r(c=g(s=m||[]).call(s,function(e){return"\u4e94\u661f\u7ea7"!==e})).call(c,function(e){return Te[e]||e}),I=g(l=f(n=[a.keyword]).call(n,T(D))).call(l,Boolean).join(" "),A={page:u,limit:10},a.city&&!p&&(A.city=h(t=String(a.city).replace(/\u5e02$/,"")).call(t)),I&&(A.keyword=I),a.starType&&"all"!==a.starType&&(A.star=a.starType),a.starType&&"all"!==a.starType||!v(o=m||[]).call(o,"\u4e94\u661f\u7ea7")||(A.star="5"),void 0!==N&&(A.min_price=N),void 0!==_&&(A.max_price=_),"price_low"===d&&(A.sort="price_asc"),"rating"===d&&(A.sort="price_desc"),e.p=2,e.n=3,S({url:"/hotel/list",method:"GET",data:A});case 3:if(M=e.v,200!==M.code){e.n=5;break}if(R=M.data,E=R.list,G=R.total,1!==u||0!==G||!a.city||p){e.n=4;break}return Y(!1),ue(!0),e.a(2,pe(a,1,d,m,!0));case 4:1!==u||p||ue(!1),J=r(E).call(E,function(e){var a,c,s=e.tags||[];if("string"===typeof e.tags)try{s=JSON.parse(e.tags)}catch(t){var l;s=g(l=e.tags.split(/[\u3001,|/ ]+/)).call(l,Boolean)}if(Array.isArray(s)&&(s=g(s).call(s,function(e){return"string"===typeof e&&(!k(e).call(e,"EN:")&&!k(e).call(e,"OPENING:")&&!k(e).call(e,"IMAGES:")&&!k(e).call(e,"ROOMDATA:"))})),!s||0===s.length){if(s=[],e.star>=5?s.push("\u8c6a\u534e\u578b"):e.star>=4?s.push("\u9ad8\u6863\u578b"):e.star>=3?s.push("\u8212\u9002\u578b"):s.push("\u7ecf\u6d4e\u578b"),e.facilities)try{var n,r="string"===typeof e.facilities?JSON.parse(e.facilities):e.facilities;if(Array.isArray(r))b(n=w(r).call(r,0,3)).call(n,function(e){var a="string"===typeof e?e:e.name;a&&a.length<=4&&!v(s).call(s,a)&&s.push(a)})}catch(t){}e.price>=1e3?s.push("\u9ad8\u7aef\u5962\u534e"):e.price<300&&s.push("\u8d85\u503c\u4f18\u60e0")}return s=w(s).call(s,0,4),x(x({},e),{},{imageUrl:null!==(a=e.cover_image)&&void 0!==a&&k(a).call(a,"http")?e.cover_image:f(c="".concat(O)).call(c,e.cover_image),tags:s,locationDesc:e.address,score:e.score})}),"rating"===d&&(J=C($=T(J)).call($,function(e,a){return Number(a.score||0)-Number(e.score||0)})),"distance"===d&&a.city&&(L=h(B=String(a.city).replace(/\u5e02$/,"")).call(B),J=C(F=T(J)).call(F,function(e,a){var c,s,l=v(c=String(e.city||"")).call(c,L)?0:1,n=v(s=String(a.city||"")).call(s,L)?0:1;return l-n})),P(1===u?J:function(e){var a;return f(a=[]).call(a,T(e),T(J))}),K(10*(u-1)+E.length<G);case 5:e.n=7;break;case 6:e.p=6,q=e.v,console.error("\u5217\u8868\u52a0\u8f7d\u5931\u8d25:",q),y({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"});case 7:return e.p=7,Y(!1),e.f(7);case 8:return e.a(2)}},e,null,[[2,6,7,8]])}));return function(a){return e.apply(this,arguments)}}(),ve=function(){if(console.log("--- \u89e6\u5e95\u4e8b\u4ef6\u6210\u529f\u89e6\u53d1 ---"),U)console.log("\u5f53\u524d\u6b63\u5728\u52a0\u8f7d\uff0c\u62e6\u622a\u8bf7\u6c42");else if(H){var e=F+1;L(e),pe(W,e,Ge,Se,oe)}else console.log("\u6ca1\u6709\u66f4\u591a\u6570\u636e\uff0c\u62e6\u622a\u8bf7\u6c42")},je=function(e){var a=x(x({},W),{},{keyword:h(e).call(e)});X(a),L(1),P([]),pe(a,1,Ge,Se)},fe=function(){var e=x(x({},W),{},{priceType:ne.price,starType:ne.star});X(e),L(1),P([]),ce(!1),pe(e,1,Ge,Se)},Ne=function(e){Je(e),Re(""),L(1),pe(W,1,e,Se)},ye=function(){console.log("\u8fd4\u56de\u5230\u9152\u5e97\u641c\u7d22\u9996\u9875"),o.switchTab({url:"/pages/index/index",success:function(){console.log("\u6210\u529f\u8fd4\u56de\u5230\u9996\u9875")},fail:function(e){console.error("\u8fd4\u56de\u5931\u8d25:",e),y({title:"\u8fd4\u56de\u5931\u8d25",icon:"error"})}})},ge=function(e){var a=j(A).call(A,function(a){return a.value===e});return a?a.label:"\u4e0d\u9650"},ke=function(e){var a=j(M).call(M,function(a){return a.value===e});return a?a.label:"\u4e0d\u9650"},be=function(e){var a,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MM-DD";if(!e)return"";var s,l,n,r=h(a=e.replace("\u6708","-").replace("\u65e5","")).call(a),t=r.split("-"),i="",o="";return t.length>=2?(i=_(s=t[t.length-2]).call(s,2,"0"),o=_(l=t[t.length-1]).call(l,2,"0"),"MM-DD"===c?f(n="".concat(i,"-")).call(n,o):r):e},we=["\u53cc\u5e8a\u623f","\u542b\u65e9\u9910","\u514d\u8d39\u53d6\u6d88","\u4eb2\u5b50\u4f18\u9009","\u667a\u80fd\u5bb6\u5c45","\u6c5f\u666f\u623f","\u5730\u94c1\u5468\u8fb9","\u4e94\u661f\u7ea7","\u6cf3\u6c60"],Te={"\u53cc\u5e8a\u623f":"\u53cc\u5e8a","\u542b\u65e9\u9910":"\u65e9\u9910","\u514d\u8d39\u53d6\u6d88":"\u514d\u8d39\u53d6\u6d88","\u4eb2\u5b50\u4f18\u9009":"\u4eb2\u5b50","\u667a\u80fd\u5bb6\u5c45":"\u667a\u80fd","\u6c5f\u666f\u623f":"\u6c5f\u666f","\u5730\u94c1\u5468\u8fb9":"\u5730\u94c1","\u6cf3\u6c60":"\u6cf3\u6c60"},_e=e.useState([]),Ce=a(_e,2),Se=Ce[0],De=Ce[1],Ie=function(e){var a=[];De(function(c){var s;return a=v(c).call(c,e)?g(c).call(c,function(a){return a!==e}):f(s=[]).call(s,T(c),[e]),a});var c=x(x({},W),{},{starType:v(a).call(a,"\u4e94\u661f\u7ea7")?"5":"5"===W.starType?"all":W.starType});X(c),L(1),P([]),pe(c,1,Ge,a)},Oe=e.useState(""),Ae=a(Oe,2),Me=Ae[0],Re=Ae[1],Ee=e.useState("welcome"),Pe=a(Ee,2),Ge=Pe[0],Je=Pe[1],Ue=[{label:"\u6b22\u8fce\u5ea6\u6392\u5e8f",value:"welcome"},{label:"\u597d\u8bc4\u4f18\u5148",value:"rating"},{label:"\u4f4e\u4ef7\u4f18\u5148",value:"price_low"}],Ye=function(e){"distance"!==e?Re(Me===e?"":e):Ne("distance")};return c.jsxs(s,{className:"list-page",children:[c.jsxs(s,{className:"sticky-header",children:[c.jsx(s,{className:"search-bar",children:c.jsx(s,{className:"search-capsule-container",children:c.jsxs(s,{className:"search-capsule",children:[c.jsx(s,{className:"back-btn",onClick:ye,children:c.jsx(n,{className:"back-icon",children:"\u2b05"})}),c.jsxs(s,{className:"capsule-section city-section",children:[c.jsx(n,{className:"city-name",children:W.city||"\u4e0d\u9650\u57ce\u5e02"}),c.jsx(s,{className:"section-divider"})]}),c.jsxs(s,{className:"capsule-section date-section",children:[c.jsxs(s,{className:"date-content",children:[c.jsxs(s,{className:"date-container",children:[c.jsx(n,{className:"date-label",children:"\u4f4f"}),c.jsx(n,{className:"date-value",children:be(W.checkInDate)||"--"})]}),c.jsxs(s,{className:"date-container",children:[c.jsx(n,{className:"date-label",children:"\u79bb"}),c.jsx(n,{className:"date-value",children:be(W.checkOutDate)||"--"})]})]}),c.jsx(s,{className:"section-divider right-vertical-line"})]}),c.jsxs(s,{className:"capsule-section keyword-section",children:[c.jsx(n,{className:"search-prefix-icon",children:"\ue8b6"}),c.jsx(m,{className:"keyword-input",placeholder:"\u57ce\u5e02/\u4f4d\u7f6e/\u54c1\u724c/\u9152\u5e97\u540d",placeholderClass:"keyword-placeholder",value:W.keyword,onInput:function(e){return X(function(a){return x(x({},a),{},{keyword:e.detail.value})})},onConfirm:function(e){return je(e.detail.value)},confirmType:"search"}),W.keyword?c.jsx(s,{className:"keyword-clear",onClick:function(){return je("")},children:c.jsx(n,{children:"\xd7"})}):null]}),c.jsx(s,{className:"search-icon-section",onClick:function(){return je(W.keyword)},children:c.jsx(n,{className:"search-icon",children:"\u641c\u7d22"})})]})})}),c.jsx(p,{className:"quick-filter-tags",scrollX:!0,showsHorizontalScrollIndicator:!1,enhanced:!0,scrollWithAnimation:!0,children:c.jsx(s,{className:"tags-container",children:r(we).call(we,function(e){return c.jsx(s,{className:"filter-tag ".concat(v(Se).call(Se,e)?"active":""),hoverClass:"filter-tag--hover",hoverStayTime:80,onClick:function(){return Ie(e)},children:c.jsx(n,{className:"tag-text",children:e})},e)})})}),c.jsxs(s,{className:"sort-bar",children:[c.jsxs(s,{className:"sort-item ".concat("welcome"===Ge||"welcome"===Me?"active":""),hoverClass:"sort-item--hover",onClick:function(){return Ye("welcome")},children:[c.jsx(n,{className:"sort-text",children:(null===(l=j(Ue).call(Ue,function(e){return e.value===Ge}))||void 0===l?void 0:l.label)||"\u6b22\u8fce\u5ea6"}),c.jsx(s,{className:"sort-icon",children:"\u25bc"})]}),c.jsxs(s,{className:"sort-item ".concat("distance"===Ge?"active":""),hoverClass:"sort-item--hover",onClick:function(){return Ye("distance")},children:[c.jsx(n,{className:"sort-text",children:"\u4f4d\u7f6e\u8ddd\u79bb"}),c.jsx(s,{className:"sort-icon",children:"\u25bc"})]}),c.jsxs(s,{className:"sort-item ".concat("all"!==W.priceType||"all"!==W.starType?"active":""),hoverClass:"sort-item--hover",onClick:function(){return ce(!0)},children:[c.jsx(n,{className:"sort-text",children:"\u4ef7\u683c/\u661f\u7ea7"}),c.jsx(s,{className:"sort-icon",children:"\u25bc"}),("all"!==W.priceType||"all"!==W.starType)&&c.jsx(s,{className:"filter-indicator"})]}),c.jsxs(s,{className:"sort-item",hoverClass:"sort-item--hover",children:[c.jsx(n,{className:"sort-text",children:"\u7b5b\u9009"}),c.jsx(s,{className:"sort-icon",children:"\u2261"})]})]}),(W.city||W.keyword||"all"!==W.priceType||"all"!==W.starType)&&c.jsx(s,{className:"filter-summary",children:c.jsxs(n,{className:"summary-text",children:["\u5f53\u524d\u7b5b\u9009:",W.city&&!oe&&" \u57ce\u5e02:".concat(W.city),W.keyword&&' "'.concat(W.keyword,'"'),"all"!==W.priceType&&" \u4ef7\u683c:".concat(ge(W.priceType)),"all"!==W.starType&&" \u661f\u7ea7:".concat(ke(W.starType))]})})]}),c.jsx(p,{scrollY:!0,className:"list-scroll",onScrollToLower:ve,lowerThreshold:200,enhanced:!0,children:c.jsxs(s,{className:"list-content",children:[oe&&W.city&&c.jsx(s,{className:"fallback-notice",children:c.jsx(n,{children:"\u5f53\u524d\u4f4d\u7f6e\u6682\u65e0\u9152\u5e97\uff0c\u4e3a\u60a8\u63a8\u8350\u4ee5\u4e0b\u70ed\u95e8\u9152\u5e97"})}),r(E).call(E,function(e){return c.jsx(I,{data:e,onClick:function(){var a,c;o.navigateTo({url:f(a=f(c="/pages/detail/index?id=".concat(e.id,"&checkIn=")).call(c,W.checkInDate,"&checkOut=")).call(a,W.checkOutDate)})}},e.id)}),c.jsx(s,{className:"loading-status-bar",children:U?c.jsx(n,{className:"status-loading",children:"\u6b63\u5728\u52aa\u529b\u52a0\u8f7d\u4e2d..."}):H?c.jsx(n,{className:"status-loading",children:"\u4e0a\u6ed1\u52a0\u8f7d\u66f4\u591a"}):c.jsxs(s,{className:"no-more-container",children:[c.jsx(s,{className:"divider-line"}),c.jsx(n,{className:"no-more-text",children:"\u5df2\u7ecf\u5230\u5e95\u5566"}),c.jsx(s,{className:"divider-line"}),!oe&&W.city&&c.jsx(s,{className:"show-all-btn",onClick:function(){var e=x(x({},W),{},{city:""});X(e),L(1),P([]),pe(e,1,Ge,Se)},children:c.jsx(n,{children:"\u67e5\u770b\u6240\u6709\u57ce\u5e02\u9152\u5e97"})})]})})]})}),c.jsx(N,{visible:"welcome"===Me,position:"top",onClose:function(){return Re("")},style:{top:"100px"},children:c.jsx(s,{className:"sort-dropdown",children:r(Ue).call(Ue,function(e){return c.jsx(s,{className:"dropdown-item ".concat(Ge===e.value?"active":""),onClick:function(){return Ne(e.value)},children:e.label},e.value)})})}),c.jsx(N,{visible:ae,position:"bottom",round:!0,onClose:function(){return ce(!1)},children:c.jsxs(s,{className:"filter-popup",children:[c.jsxs(s,{className:"popup-header",children:[c.jsx(n,{className:"title",children:"\u4ef7\u683c/\u661f\u7ea7\u7b5b\u9009"}),c.jsx(n,{className:"close",onClick:function(){return ce(!1)},children:"\u2715"})]}),c.jsxs(p,{scrollY:!0,className:"popup-body",children:[c.jsxs(s,{className:"section",children:[c.jsx(n,{className:"section-title",children:"\u4ef7\u683c\u9884\u7b97"}),c.jsx(s,{className:"tags-grid",children:r(A).call(A,function(e){return c.jsx(s,{className:"tag ".concat(ne.price===e.value?"active":""),onClick:function(){return re(function(a){return x(x({},a),{},{price:e.value})})},children:e.label},e.value)})})]}),c.jsxs(s,{className:"section",children:[c.jsx(n,{className:"section-title",children:"\u661f\u7ea7\u6807\u51c6"}),c.jsx(s,{className:"tags-grid",children:r(M).call(M,function(e){return c.jsx(s,{className:"tag ".concat(ne.star===e.value?"active":""),onClick:function(){return re(function(a){return x(x({},a),{},{star:e.value})})},children:e.label},e.value)})})]})]}),c.jsxs(s,{className:"popup-footer",children:[c.jsx(s,{className:"btn reset",onClick:function(){return re({price:"all",star:"all"})},children:"\u91cd\u7f6e"}),c.jsx(s,{className:"btn confirm",onClick:fe,children:"\u67e5\u770b\u9152\u5e97"})]})]})})]})}export{R as default};
