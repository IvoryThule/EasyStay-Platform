import{t as e,q as s,v as r,p as n,V as a,A as t,w as i,T as o,m as c,n as l,s as u,G as d,E as m,F as p}from"./vendors.5d021e99.js";import{r as f}from"./common.7dfb5deb.js";var v=["/pages/index/index","/pages/list/index","/pages/order/index","/pages/user/index"];function g(){var g,w=e.useRouter(),h=s.useMemo(function(){var e,s=(null===w||void 0===w||null===(e=w.params)||void 0===e?void 0:e.redirect)||"/pages/user/index";try{return decodeURIComponent(s)}catch(r){return s}},[null===w||void 0===w||null===(g=w.params)||void 0===g?void 0:g.redirect]),x=s.useState("login"),j=r(x,2),b=j[0],k=j[1],N=s.useState(!1),P=r(N,2),T=P[0],C=P[1],I=s.useState({username:"",password:"",confirmPassword:""}),S=r(I,2),y=S[0],O=S[1],R=function(){var s=c(l().m(function s(){var r,n,a,t,i,o,c;return l().w(function(s){while(1)switch(s.p=s.n){case 0:if(p(r=y.username).call(r)){s.n=1;break}return u({title:"\u8bf7\u8f93\u5165\u8d26\u53f7",icon:"none"}),s.a(2);case 1:if(p(n=y.password).call(n)){s.n=2;break}return u({title:"\u8bf7\u8f93\u5165\u5bc6\u7801",icon:"none"}),s.a(2);case 2:if("register"!==b||y.password===y.confirmPassword){s.n=3;break}return u({title:"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4",icon:"none"}),s.a(2);case 3:if(C(!0),s.p=4,"register"!==b){s.n=6;break}return s.n=5,f({url:"/auth/register",method:"POST",data:{username:p(t=y.username).call(t),password:y.password,role:"user"}});case 5:if(i=s.v,200===i.code){s.n=6;break}return u({title:i.msg||"\u6ce8\u518c\u5931\u8d25",icon:"none"}),s.a(2);case 6:return s.n=7,f({url:"/auth/login",method:"POST",data:{username:p(a=y.username).call(a),password:y.password}});case 7:o=s.v,200===o.code?(d("token",o.data.token),d("userInfo",o.data.user),u({title:"register"===b?"\u6ce8\u518c\u5e76\u767b\u5f55\u6210\u529f":"\u767b\u5f55\u6210\u529f",icon:"success"}),m(v).call(v,h)?e.switchTab({url:h}):e.redirectTo({url:h}).catch(function(){return e.switchTab({url:"/pages/user/index"})})):u({title:o.msg||"\u767b\u5f55\u5931\u8d25",icon:"none"}),s.n=9;break;case 8:s.p=8,c=s.v,u({title:(null===c||void 0===c?void 0:c.msg)||"\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"});case 9:return s.p=9,C(!1),s.f(9);case 10:return s.a(2)}},s,null,[[4,8,9,10]])}));return function(){return s.apply(this,arguments)}}(),_=function(){O({username:"register"===b?"new_user":"test_user",password:"123456",confirmPassword:"123456"})};return n.jsx(a,{className:"login-page",children:n.jsxs(a,{className:"card",children:[n.jsxs(a,{className:"tabs",children:[n.jsx(a,{className:"tab ".concat("login"===b?"active":""),onClick:function(){return k("login")},children:"\u767b\u5f55"}),n.jsx(a,{className:"tab ".concat("register"===b?"active":""),onClick:function(){return k("register")},children:"\u6ce8\u518c"})]}),n.jsxs(a,{className:"form",children:[n.jsx(t,{className:"field",placeholder:"\u8bf7\u8f93\u5165\u8d26\u53f7",value:y.username,onInput:function(e){return O(function(s){return i(i({},s),{},{username:e.detail.value})})}}),n.jsx(t,{className:"field",type:"password",placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",value:y.password,onInput:function(e){return O(function(s){return i(i({},s),{},{password:e.detail.value})})}}),"register"===b?n.jsx(t,{className:"field",type:"password",placeholder:"\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801",value:y.confirmPassword,onInput:function(e){return O(function(s){return i(i({},s),{},{confirmPassword:e.detail.value})})}}):null]}),n.jsxs(a,{className:"actions",children:[n.jsx(a,{className:"submit-btn",onClick:R,children:T?"\u63d0\u4ea4\u4e2d...":"register"===b?"\u6ce8\u518c\u5e76\u767b\u5f55":"\u7acb\u5373\u767b\u5f55"}),n.jsx(o,{className:"demo-link",onClick:_,children:"\u4e00\u952e\u586b\u5145\u793a\u4f8b\u8d26\u53f7"})]})]})})}export{g as default};
