import{v as t,x as e,u as s,V as a,T as r,S as n,A as c,U as l,_ as i,I as o,c as u,D as d,C as h,y as m,W as x,t as g,o as p,p as f,s as j,K as v,X as N,F as y,b}from"./vendors.8928da7e.js";import{r as w}from"./common.0834f2a9.js";var S=["\u6211\u60f3\u53bb\u5317\u4eac\u73a9\uff0c\u9884\u7b97\u4e0d\u9650\uff0c\u63a8\u8350\u8c6a\u534e\u9152\u5e97","\u5317\u4eac 400 \u5143\u4ee5\u5185\u6709\u4ec0\u4e48\u9152\u5e97\uff1f","\u8fd9\u4e2a\u9152\u5e97\u9644\u8fd1\u6709\u4ec0\u4e48\u666f\u70b9\uff1f"],k="https://images.unsplash.com/photo-1566073771259-6a8506099945";function A(t){return t?b(t).call(t,"http")?t:"http://1.14.207.212:8848".concat(t):k}function C(){var t;return i(t="msg-".concat(Date.now(),"-")).call(t,Math.floor(1e4*Math.random()))}function P(t){return{id:C(),role:"user",type:"text",text:t,structured:[],cards:[],createdAt:Date.now()}}function T(t){var e,s=(null===t||void 0===t?void 0:t.message)||{},a=s.type||"text",r=s.text||(null===t||void 0===t?void 0:t.content)||(null===t||void 0===t?void 0:t.reply)||"\u62b1\u6b49\uff0c\u6682\u65f6\u65e0\u6cd5\u56de\u7b54\u3002",n=Array.isArray(s.structured)?s.structured:[],l=Array.isArray(null===t||void 0===t?void 0:t.thoughtProcess)?t.thoughtProcess:[],i=Array.isArray(s.cards)?c(e=s.cards).call(e,function(t){return m(m({},t),{},{cover_image:A(t.cover_image)})}):[];return{id:C(),role:"assistant",type:a,text:r,structured:n,thoughtProcess:l,cards:i,createdAt:Date.now(),isTyping:!0}}function _(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c(t=u(e).call(e,-10)).call(t,function(t){return{role:"assistant"===t.role?"assistant":"user",content:t.text}})}function D(){var b=t.useState([{id:C(),role:"assistant",type:"text",text:"\u60a8\u597d\uff0c\u6211\u662f EasyStay \u667a\u80fd\u52a9\u624b\u3002\u544a\u8bc9\u6211\u57ce\u5e02\u3001\u9884\u7b97\u548c\u504f\u597d\uff0c\u6211\u4f1a\u57fa\u4e8e\u771f\u5b9e\u9152\u5e97\u6570\u636e\u63a8\u8350\uff1b\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u95ee\u201c\u8fd9\u4e2a\u9152\u5e97\u9644\u8fd1\u6709\u4ec0\u4e48\u666f\u70b9/\u7f8e\u98df/\u5730\u94c1\u201d\u3002",structured:[],thoughtProcess:[],cards:[],createdAt:Date.now(),isTyping:!1}]),k=e(b,2),A=k[0],D=k[1],I=t.useState({city:null,budgetIntent:null,travelPurpose:null,preferences:[],lastHotel:null,lastTool:null}),q=e(I,2),E=q[0],F=q[1],M=t.useState(""),V=e(M,2),W=V[0],B=V[1],H=t.useState(!1),K=e(H,2),O=K[0],U=K[1],X=t.useState("\u2728 \u6df1\u5ea6\u601d\u8003\u4e2d..."),Y=e(X,2),z=Y[0],G=Y[1],J=t.useState(""),L=e(J,2),Q=L[0],R=L[1],Z=t.useState({}),$=e(Z,2),tt=$[0],et=$[1],st=function(t){return et(function(e){return m(m({},e),{},x({},t,!e[t]))})},at=function(t){D(function(e){var s;return i(s=[]).call(s,v(e),[t])}),R(t.id)},rt=function(t){var e=t.detail_path||"/pages/detail/index?id=".concat(t.id);g.navigateTo({url:e})},nt=function(){g.navigateBack({fail:function(){g.switchTab({url:"/pages/index/index"})}})},ct=function(){var t=p(f().m(function t(e){var s,a,r,n,c,l,o,u,d,h,m;return f().w(function(t){while(1)switch(t.p=t.n){case 0:if(r=y(s=String(e||"")).call(s),r&&!O){t.n=1;break}return t.a(2);case 1:return n=P(r),c=i(a=[]).call(a,v(A),[n]),at(n),B(""),U(!0),l=0,o=["\u2728 \u6df1\u5ea6\u601d\u8003\u4e2d...","\u2728 \u6df1\u5ea6\u601d\u8003\u4e2d...","\ud83d\udee0\ufe0f \u6b63\u5728\u8c03\u5ea6\u5de5\u5177\u67e5\u627e\u6570\u636e...","\ud83d\udee0\ufe0f \u6b63\u5728\u8c03\u5ea6\u5de5\u5177\u67e5\u627e\u6570\u636e...","\ud83d\udcdd \u6574\u7406\u63a8\u8350\u4e2d..."],u=N(function(){l++,o[l]&&G(o[l])},1500),t.p=2,t.n=3,w({url:"/ai/chat",method:"POST",data:{message:r,history:_(c),sessionContext:E}});case 3:if(h=t.v,200===h.code){t.n=4;break}throw new Error(h.msg||"\u8bf7\u6c42\u5931\u8d25");case 4:m=T(h.data||{}),at(m),null!==(d=h.data)&&void 0!==d&&d.sessionContext&&F(h.data.sessionContext),t.n=6;break;case 5:t.p=5,t.v,j({title:"\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",icon:"none"}),at({id:C(),role:"assistant",type:"text",text:"\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",structured:[],thoughtProcess:[],cards:[],createdAt:Date.now(),isTyping:!1});case 6:return t.p=6,clearInterval(u),U(!1),G("\u2728 \u6df1\u5ea6\u601d\u8003\u4e2d..."),t.f(6);case 7:return t.a(2)}},t,null,[[2,5,6,7]])}));return function(e){return t.apply(this,arguments)}}();return s.jsxs(a,{className:"ai-chat-page",children:[s.jsxs(a,{className:"chat-header",children:[s.jsx(r,{className:"back-btn",onClick:nt,children:"\u2039"}),s.jsx(r,{className:"title",children:"EasyStay \u667a\u80fd\u52a9\u624b"})]}),s.jsxs(n,{className:"chat-content",scrollY:!0,scrollIntoView:Q,scrollWithAnimation:!0,children:[c(A).call(A,function(t){var e,n,h;return s.jsxs(a,{id:t.id,className:"msg-row ".concat(t.role),children:[t.thoughtProcess&&t.thoughtProcess.length>0&&s.jsxs(a,{className:"thought-process",children:[s.jsxs(a,{className:"thought-header",onClick:function(){return st(t.id)},children:[s.jsx(r,{className:"thought-title",children:"\ud83d\udee0\ufe0f \u6df1\u5ea6\u601d\u8003\u4e0e\u8c03\u5ea6\u8fc7\u7a0b"}),s.jsx(r,{className:"thought-arrow",children:tt[t.id]?"\u25b2 \u6536\u8d77":"\u25bc \u5c55\u5f00"})]}),tt[t.id]&&c(e=t.thoughtProcess).call(e,function(t,e){return s.jsxs(a,{className:"thought-step",children:[s.jsxs(r,{className:"thought-tool",children:["\u8c03\u7528\u5de5\u5177\uff1a",t.tool]}),s.jsxs(r,{className:"thought-args",children:["\u53c2\u6570\uff1a",l(t.toolInput)]})]},e)})]}),s.jsx(a,{className:"bubble",children:s.jsx(r,{style:{whiteSpace:"pre-wrap"},children:t.text})}),t.structured&&t.structured.length>0&&s.jsx(a,{className:"structured-list",children:c(n=t.structured).call(n,function(e,a){var n;return s.jsx(r,{className:"structured-line",children:e},i(n="".concat(t.id,"-")).call(n,a))})}),"hotel_cards"===t.type&&t.cards&&t.cards.length>0&&s.jsx(a,{className:"card-list",children:c(h=t.cards).call(h,function(e){var n,l,h,m;return s.jsxs(a,{className:"hotel-card",children:[s.jsx(o,{className:"cover",src:e.cover_image,mode:"aspectFill"}),s.jsxs(a,{className:"card-body",children:[s.jsx(r,{className:"name",children:e.name}),s.jsxs(r,{className:"meta",children:[e.city," \xb7 ",e.star,"\u661f \xb7 \u8bc4\u5206 ",e.score]}),s.jsxs(r,{className:"price",children:["\xa5",e.price," \u8d77/\u665a"]}),s.jsx(a,{className:"tags",children:c(n=u(l=e.tags||[]).call(l,0,4)).call(n,function(t){var a;return s.jsx(r,{className:"tag",children:t},i(a="".concat(e.id,"-")).call(a,t))})}),s.jsxs(r,{className:"reason",children:["\u4eae\u70b9\uff1a",e.recommend_reason]}),s.jsx(d,{className:"detail-btn",onClick:function(){return rt(e)},children:"\u67e5\u770b\u8be6\u60c5"})]})]},i(h=i(m="".concat(t.id,"-")).call(m,e.id,"-")).call(h,e.name))})})]},t.id)}),O&&s.jsx(a,{className:"msg-row assistant",children:s.jsx(a,{className:"bubble loading-bubble",children:s.jsx(r,{className:"loading-text",children:z})})})]}),s.jsx(a,{className:"quick-questions",children:c(S).call(S,function(t){return s.jsx(a,{className:"quick-item",onClick:function(){return ct(t)},children:s.jsx(r,{children:t})},t)})}),s.jsxs(a,{className:"input-bar",children:[s.jsx(h,{className:"input",value:W,onInput:function(t){return B(t.detail.value)},placeholder:"\u544a\u8bc9\u6211\uff1a\u57ce\u5e02 + \u9884\u7b97 + \u504f\u597d\uff0c\u6216\u95ee\u9644\u8fd1\u4fe1\u606f",confirmType:"send",onConfirm:function(){return ct(W)}}),s.jsx(d,{className:"send-btn",onClick:function(){return ct(W)},loading:O,children:"\u53d1\u9001"})]})]})}export{D as default};
