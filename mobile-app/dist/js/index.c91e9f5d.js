import{v as e,g as a,x as l,o as s,p as n,$ as c,s as r,t,u as i,V as o,T as d,S as u,A as m,I as h,b as v,_ as p}from"./vendors.b3871b3f.js";import{r as x}from"./common.5a71e493.js";var j=[{label:"\u5168\u90e8",value:"all"},{label:"\u5f85\u652f\u4ed8",value:0},{label:"\u5df2\u9884\u8ba2",value:1},{label:"\u5df2\u53d6\u6d88",value:2}],N={0:"\u5f85\u652f\u4ed8",1:"\u5df2\u9884\u8ba2",2:"\u5df2\u53d6\u6d88"},f="http://1.14.207.212:8848";function g(){var g=e.useState(!!a("token")),b=l(g,2),y=b[0],k=b[1],w=e.useState(!1),S=l(w,2),T=S[0],C=S[1],_=e.useState([]),A=l(_,2),R=A[0],D=A[1],F=e.useState("all"),H=l(F,2),I=H[0],P=H[1],E=e.useState(null),G=l(E,2),O=G[0],V=G[1],X=function(e){var a,l,s=(null===e||void 0===e||null===(a=e.Hotel)||void 0===a?void 0:a.cover_image)||"";return s?v(s).call(s,"http")?s:p(l="".concat(f)).call(l,s):""},Y=e.useCallback(s(n().m(function e(){var l,s,t,i,o,d,u=arguments;return n().w(function(e){while(1)switch(e.p=e.n){case 0:if(l=u.length>0&&void 0!==u[0]?u[0]:I,s=a("token"),t=!!s,k(t),t){e.n=1;break}return D([]),c(),e.a(2);case 1:return C(!0),e.p=2,i="all"===l?{}:{status:l},e.n=3,x({url:"/order/list",method:"GET",data:i});case 3:o=e.v,200===o.code?D(Array.isArray(o.data)?o.data:[]):r({title:o.msg||"\u83b7\u53d6\u8ba2\u5355\u5931\u8d25",icon:"none"}),e.n=5;break;case 4:e.p=4,d=e.v,r({title:(null===d||void 0===d?void 0:d.msg)||"\u83b7\u53d6\u8ba2\u5355\u5931\u8d25",icon:"none"});case 5:return e.p=5,C(!1),c(),e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])})),[I]);t.useDidShow(function(){Y(I)}),t.usePullDownRefresh(function(){Y(I)});var $=function(e){P(e),Y(e)},q=function(){var e=s(n().m(function e(a,l){var s,c,t,i;return n().w(function(e){while(1)switch(e.p=e.n){case 0:return V(l),e.p=1,s="pay"===a?"/order/pay":"/order/cancel",c="pay"===a?"\u652f\u4ed8":"\u53d6\u6d88",e.n=2,x({url:s,method:"POST",data:{orderId:l}});case 2:t=e.v,200===t.code?(r({title:t.msg||"".concat(c,"\u6210\u529f"),icon:"success"}),Y(I)):r({title:t.msg||"".concat(c,"\u5931\u8d25"),icon:"none"}),e.n=4;break;case 3:e.p=3,i=e.v,r({title:(null===i||void 0===i?void 0:i.msg)||"\u64cd\u4f5c\u5931\u8d25",icon:"none"});case 4:return e.p=4,V(null),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(a,l){return e.apply(this,arguments)}}();return y?i.jsxs(o,{className:"order-page",children:[i.jsx(u,{className:"tab-scroll",scrollX:!0,showScrollbar:!1,children:i.jsx(o,{className:"tab-row",children:m(j).call(j,function(e){return i.jsx(o,{className:"tab-item ".concat(I===e.value?"active":""),onClick:function(){return $(e.value)},children:e.label},String(e.value))})})}),i.jsxs(u,{className:"order-list",scrollY:!0,children:[T?i.jsx(d,{className:"placeholder",children:"\u8ba2\u5355\u52a0\u8f7d\u4e2d..."}):null,T||0!==R.length?null:i.jsx(d,{className:"placeholder",children:"\u6682\u65e0\u8ba2\u5355\u8bb0\u5f55"}),m(R).call(R,function(e){var a,l,s;return i.jsxs(o,{className:"order-card",children:[i.jsxs(o,{className:"card-header",children:[i.jsx(d,{className:"hotel-name",children:(null===e||void 0===e||null===(a=e.Hotel)||void 0===a?void 0:a.name)||"\u9152\u5e97\u4fe1\u606f"}),i.jsx(d,{className:"status-tag status-".concat(e.status),children:N[e.status]||"\u672a\u77e5\u72b6\u6001"})]}),i.jsxs(o,{className:"card-body",children:[X(e)?i.jsx(h,{className:"hotel-image",src:X(e),mode:"aspectFill"}):i.jsx(o,{className:"hotel-image placeholder-img",children:"\u65e0\u56fe"}),i.jsxs(o,{className:"order-info",children:[i.jsx(d,{className:"room-name",children:(null===e||void 0===e||null===(l=e.RoomType)||void 0===l?void 0:l.name)||"\u6807\u51c6\u623f\u578b"}),i.jsxs(d,{className:"date-text",children:["\u5165\u4f4f: ",e.check_in]}),i.jsxs(d,{className:"date-text",children:["\u79bb\u5e97: ",e.check_out]}),i.jsxs(d,{className:"price-text",children:["\xa5",Number((null===e||void 0===e||null===(s=e.RoomType)||void 0===s?void 0:s.price)||0).toFixed(0)," / \u665a"]})]})]}),0===e.status?i.jsxs(o,{className:"card-actions",children:[i.jsx(o,{className:"action-btn secondary",onClick:function(){return q("cancel",e.id)},children:O===e.id?"\u5904\u7406\u4e2d...":"\u53d6\u6d88\u8ba2\u5355"}),i.jsx(o,{className:"action-btn primary",onClick:function(){return q("pay",e.id)},children:O===e.id?"\u5904\u7406\u4e2d...":"\u7acb\u5373\u652f\u4ed8"})]}):null]},e.id)})]})]}):i.jsxs(o,{className:"order-page empty-login",children:[i.jsx(d,{className:"tip-title",children:"\u8bf7\u5148\u767b\u5f55\u540e\u67e5\u770b\u8ba2\u5355"}),i.jsx(d,{className:"tip-subtitle",children:"\u767b\u5f55\u540e\u53ef\u67e5\u770b\u652f\u4ed8\u72b6\u6001\u3001\u5165\u4f4f\u4fe1\u606f\u5e76\u5b8c\u6210\u652f\u4ed8/\u53d6\u6d88"}),i.jsx(o,{className:"login-btn",onClick:function(){return t.navigateTo({url:"/pages/login/index?redirect=/pages/order/index"})},children:"\u53bb\u767b\u5f55"})]})}export{g as default};
