import{t as a,v as e,x as s,w as c,u as n,V as t,T as l,S as i,z as r,A as o,B as d,I as u,a2 as m,a3 as h,b as f,_ as g,U as p,H as x,a4 as v,o as N,p as j,s as y,K as k,J as b,a1 as w,g as I,y as C}from"./vendors.0e37b5be.js";import{r as D}from"./common.6aeea0c4.js";var S=function(){var S,Y,F,O,_=a.useRouter(),M=e.useState(!0),T=s(M,2),A=T[0],J=T[1],P=e.useState(null),R=s(P,2),U=R[0],B=R[1],z=e.useState([]),E=s(z,2),H=E[0],K=E[1],L="http://1.14.207.212:8848",V=e.useState(!1),X=s(V,2),q=X[0],G=X[1],Q=e.useState({checkIn:"",checkOut:"",nightCount:1}),W=s(Q,2),Z=W[0],$=W[1],aa=e.useState(null),ea=s(aa,2),sa=ea[0],ca=ea[1],na=function(a,e){var s,c,n=(new Date).getFullYear(),t=g(s=g(c="".concat(n,"/")).call(c,(new Date).getMonth()+1,"/")).call(s,(new Date).getDate()),l=function(a){if(!a||"string"!==typeof a||!k(a).call(a,"\u6708"))return t;try{var e,s,c,l,i,r=b(e=a.replace("\u6708","/").replace("\u65e5","")).call(e),o=r.split("/");if(o.length<2)return t;var d=w(s=o[0]).call(s,2,"0"),u=w(c=o[1]).call(c,2,"0");return g(l=g(i="".concat(n,"/")).call(i,d,"/")).call(l,u)}catch(m){return t}},i=new Date(l(a)),r=new Date(l(e));if(isNaN(i.getTime())||isNaN(r.getTime()))return 1;var o=Math.ceil((r-i)/864e5);return o>0?o:1};e.useEffect(function(){var a=_.params,e=a.id,s=a.checkIn,n=a.checkOut,t=s?decodeURIComponent(s):c().format("M\u6708D\u65e5"),l=n?decodeURIComponent(n):c().add(1,"day").format("M\u6708D\u65e5");$({checkIn:t,checkOut:l,nightCount:na(t,l)}),e&&ia(e)},[_.params]);var ta=function(a){var e,s,n,t,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=c().add(l,"day").format("YYYY-MM-DD");if(!a||"string"!==typeof a)return i;var r=a.match(/(\d{1,2})\u6708(\d{1,2})\u65e5/);if(!r)return i;var o=c().year(),d=w(e=r[1]).call(e,2,"0"),u=w(s=r[2]).call(s,2,"0");return c(g(n=g(t="".concat(o,"-")).call(t,d,"-")).call(n,u)).format("YYYY-MM-DD")},la=function(){var e=N(j().m(function e(s){var c,n,t;return j().w(function(e){while(1)switch(e.p=e.n){case 0:if(c=I("token"),c){e.n=1;break}return a.navigateTo({url:"/pages/login/index?redirect=/pages/order/index"}),e.a(2);case 1:if(null!==U&&void 0!==U&&U.id&&null!==s&&void 0!==s&&s.id){e.n=2;break}return y({title:"\u4e0b\u5355\u53c2\u6570\u5f02\u5e38",icon:"none"}),e.a(2);case 2:return ca(s.id),e.p=3,e.n=4,D({url:"/order/create",method:"POST",data:{hotel_id:U.id,room_type_id:s.id,check_in:ta(Z.checkIn,0),check_out:ta(Z.checkOut,1)}});case 4:n=e.v,200===n.code?(y({title:"\u4e0b\u5355\u6210\u529f",icon:"success"}),a.switchTab({url:"/pages/order/index"})):y({title:n.msg||"\u4e0b\u5355\u5931\u8d25",icon:"none"}),e.n=6;break;case 5:e.p=5,t=e.v,y({title:(null===t||void 0===t?void 0:t.msg)||"\u4e0b\u5355\u5931\u8d25",icon:"none"});case 6:return e.p=6,ca(null),e.f(6);case 7:return e.a(2)}},e,null,[[3,5,6,7]])}));return function(a){return e.apply(this,arguments)}}(),ia=function(){var a=N(j().m(function a(e){var s,c,n,t,l,i;return j().w(function(a){while(1)switch(a.p=a.n){case 0:return J(!0),a.p=1,a.n=2,D({url:"/hotel/detail/".concat(e)});case 2:return s=a.v,a.n=3,D({url:"/hotel/roomtype/list",data:{hotel_id:e}});case 3:if(c=a.v,200===s.code&&s.data){if(n=s.data,t=[],n.images)try{l=n.images,i="string"===typeof l?JSON.parse(l):l,Array.isArray(i)&&i.length>0&&(t=i)}catch(r){console.error("Parse images failed",r)}0===t.length&&n.cover_image&&(t=[n.cover_image]),0===t.length&&(t=["https://dummyimage.com/750x400/cccccc/ffffff&text=No+Image"]),B(C(C({},n),{},{displayImages:o(t).call(t,function(a){var e;return f(a).call(a,"http")?a:g(e="".concat(L)).call(e,a)}),displayFacilities:n.facilities?"string"===typeof n.facilities?JSON.parse(n.facilities):n.facilities:[]}))}200===c.code&&Array.isArray(c.data)&&K(c.data),a.n=5;break;case 4:a.p=4,a.v,y({title:"\u83b7\u53d6\u8be6\u60c5\u5931\u8d25",icon:"none"});case 5:return a.p=5,J(!1),a.f(5);case 6:return a.a(2)}},a,null,[[1,4,5,6]])}));return function(e){return a.apply(this,arguments)}}(),ra=function(){var e=a.getCurrentPages();e.length>1?a.navigateBack():a.switchTab({url:"/pages/list/index"}).catch(function(){a.reLaunch({url:"/pages/list/index"})})};return A?n.jsx(t,{className:"loading-container",children:n.jsx(l,{children:"\u6b63\u5728\u52a0\u8f7d\u9152\u5e97\u8be6\u60c5..."})}):n.jsxs(t,{className:"detail-page",children:[n.jsxs(t,{className:"custom-nav",children:[n.jsx(t,{className:"back-icon",onClick:ra,children:"\u2190"}),n.jsx(l,{className:"nav-title",children:(null===U||void 0===U?void 0:U.name)||"\u9152\u5e97\u8be6\u60c5"})]}),n.jsxs(i,{scrollY:!0,className:"scroll-content",style:{height:"100vh"},children:[n.jsx(t,{className:"banner-area",children:null!==U&&void 0!==U&&U.displayImages&&U.displayImages.length>0?n.jsx(r,{className:"banner-swiper",circular:!0,indicatorDots:!0,indicatorActiveColor:"#2563eb",autoplay:!0,interval:4e3,children:o(S=U.displayImages).call(S,function(a,e){return n.jsx(d,{children:n.jsx(u,{src:a,mode:"aspectFill",className:"banner-image",onClick:function(){m({urls:U.displayImages,current:a})}})},e)})}):n.jsx(t,{className:"no-img",children:"\u6682\u65e0\u56fe\u7247"})}),"    ",n.jsxs(t,{className:"info-card",children:[n.jsx(l,{className:"name",children:null===U||void 0===U?void 0:U.name}),(null===U||void 0===U?void 0:U.star)&&n.jsxs(t,{className:"star-bar",children:[n.jsx(l,{className:"star-text",children:h(Y="\u2605").call(Y,U.star)}),n.jsxs(l,{className:"star-label",children:[U.star,"\u661f\u7ea7\u9152\u5e97"]})]}),n.jsxs(t,{className:"address-bar",children:["\u4f4d\u7f6e: ",null===U||void 0===U?void 0:U.address]}),(null===U||void 0===U?void 0:U.displayFacilities)&&U.displayFacilities.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(t,{className:"section-title",children:"\u9152\u5e97\u8bbe\u65bd"}),n.jsx(i,{scrollX:!0,className:"facility-scroll",children:o(F=U.displayFacilities).call(F,function(a,e){return n.jsx(t,{className:"facility-item",children:n.jsx(l,{className:"f-name",children:"string"===typeof a?a:a.name})},e)})})]})]}),n.jsx(t,{className:"calendar-bar",onClick:function(){return G(!0)},children:n.jsxs(t,{className:"inner",children:[n.jsx(t,{className:"date-item",children:n.jsx(t,{className:"date",children:Z.checkIn})}),n.jsxs(t,{className:"night-count",children:[Z.nightCount,"\u665a"]}),n.jsx(t,{className:"date-item",children:n.jsx(t,{className:"date",children:Z.checkOut})})]})}),n.jsx(t,{className:"section-title",style:{padding:"0 30px",margin:"20px 0 10px"},children:"\u9884\u8ba2\u623f\u578b"}),n.jsx(t,{className:"room-list",children:o(O=H||[]).call(O,function(a){var e,s;return n.jsxs(t,{className:"room-card",children:[n.jsx(u,{src:a.image?f(e=a.image).call(e,"http")?a.image:g(s="".concat(L)).call(s,a.image):"",className:"room-img",mode:"aspectFill"}),n.jsxs(t,{className:"room-info",children:[n.jsx(l,{className:"r-name",children:a.name}),n.jsxs(t,{className:"r-bottom",children:[n.jsxs(l,{className:"price",children:["\xa5",p(a.price).toFixed(0)]}),n.jsx(t,{className:"btn-book",onClick:function(){return la(a)},children:sa===a.id?"\u9884\u8ba2\u4e2d...":"\u9884\u8ba2"})]})]})]},a.id)})})]}),n.jsx(x,{visible:q,type:"range",onClose:function(){return G(!1)},onConfirm:function(a){var e,s,c=g(e="".concat(v(a[0][1]),"\u6708")).call(e,v(a[0][2]),"\u65e5"),n=g(s="".concat(v(a[1][1]),"\u6708")).call(s,v(a[1][2]),"\u65e5");$({checkIn:c,checkOut:n,nightCount:na(c,n)}),G(!1)}})]})};export{S as default};
