import{t as e,q as r,v as n,g as s,p as a,V as t,A as i,w as o,T as c,m as u,n as l,E as d,s as m,G as p,F as f}from"./vendors.396e8f70.js";import{r as v}from"./common.b2b60190.js";var w=["/pages/index/index","/pages/list/index","/pages/order/index","/pages/user/index"];function h(){var h,g=e.useRouter(),x=r.useMemo(function(){var e,r=(null===g||void 0===g||null===(e=g.params)||void 0===e?void 0:e.redirect)||"/pages/order/index";try{return decodeURIComponent(r)}catch(n){return r}},[null===g||void 0===g||null===(h=g.params)||void 0===h?void 0:h.redirect]),k=r.useState("login"),b=n(k,2),j=b[0],N=b[1],P=r.useState(!1),S=n(P,2),T=S[0],y=S[1],C=r.useState({username:"",password:"",confirmPassword:""}),I=n(C,2),O=I[0],R=I[1],_=function(){var r=u(l().m(function r(n){return l().w(function(r){while(1)switch(r.p=r.n){case 0:if(!d(w).call(w,n)){r.n=4;break}return r.p=1,r.n=2,e.switchTab({url:n});case 2:return r.a(2);case 3:r.p=3,r.v;case 4:e.redirectTo({url:n}).catch(function(){return e.switchTab({url:"/pages/order/index"})});case 5:return r.a(2)}},r,null,[[1,3]])}));return function(e){return r.apply(this,arguments)}}();e.useDidShow(function(){var e=s("token");e&&_(x)});var q=function(){var e=u(l().m(function e(){var r,n,s,a,t,i,o;return l().w(function(e){while(1)switch(e.p=e.n){case 0:if(f(r=O.username).call(r)){e.n=1;break}return m({title:"\u8bf7\u8f93\u5165\u8d26\u53f7",icon:"none"}),e.a(2);case 1:if(f(n=O.password).call(n)){e.n=2;break}return m({title:"\u8bf7\u8f93\u5165\u5bc6\u7801",icon:"none"}),e.a(2);case 2:if("register"!==j||O.password===O.confirmPassword){e.n=3;break}return m({title:"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4",icon:"none"}),e.a(2);case 3:if(y(!0),e.p=4,"register"!==j){e.n=6;break}return e.n=5,v({url:"/auth/register",method:"POST",data:{username:f(a=O.username).call(a),password:O.password,role:"user"}});case 5:if(t=e.v,200===t.code){e.n=6;break}return m({title:t.msg||"\u6ce8\u518c\u5931\u8d25",icon:"none"}),e.a(2);case 6:return e.n=7,v({url:"/auth/login",method:"POST",data:{username:f(s=O.username).call(s),password:O.password}});case 7:i=e.v,200===i.code?(p("token",i.data.token),p("userInfo",i.data.user),m({title:"register"===j?"\u6ce8\u518c\u5e76\u767b\u5f55\u6210\u529f":"\u767b\u5f55\u6210\u529f",icon:"success"}),_(x)):m({title:i.msg||"\u767b\u5f55\u5931\u8d25",icon:"none"}),e.n=9;break;case 8:e.p=8,o=e.v,m({title:(null===o||void 0===o?void 0:o.msg)||"\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"});case 9:return e.p=9,y(!1),e.f(9);case 10:return e.a(2)}},e,null,[[4,8,9,10]])}));return function(){return e.apply(this,arguments)}}(),A=function(){R({username:"register"===j?"new_user":"test_user",password:"123456",confirmPassword:"123456"})};return a.jsx(t,{className:"login-page",children:a.jsxs(t,{className:"card",children:[a.jsxs(t,{className:"tabs",children:[a.jsx(t,{className:"tab ".concat("login"===j?"active":""),onClick:function(){return N("login")},children:"\u767b\u5f55"}),a.jsx(t,{className:"tab ".concat("register"===j?"active":""),onClick:function(){return N("register")},children:"\u6ce8\u518c"})]}),a.jsxs(t,{className:"form",children:[a.jsx(i,{className:"field",placeholder:"\u8bf7\u8f93\u5165\u8d26\u53f7",value:O.username,onInput:function(e){return R(function(r){return o(o({},r),{},{username:e.detail.value})})}}),a.jsx(i,{className:"field",type:"password",placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",value:O.password,onInput:function(e){return R(function(r){return o(o({},r),{},{password:e.detail.value})})}}),"register"===j?a.jsx(i,{className:"field",type:"password",placeholder:"\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801",value:O.confirmPassword,onInput:function(e){return R(function(r){return o(o({},r),{},{confirmPassword:e.detail.value})})}}):null]}),a.jsxs(t,{className:"actions",children:[a.jsx(t,{className:"submit-btn",onClick:q,children:T?"\u63d0\u4ea4\u4e2d...":"register"===j?"\u6ce8\u518c\u5e76\u767b\u5f55":"\u7acb\u5373\u767b\u5f55"}),a.jsx(c,{className:"demo-link",onClick:A,children:"\u4e00\u952e\u586b\u5145\u793a\u4f8b\u8d26\u53f7"})]})]})})}export{h as default};
