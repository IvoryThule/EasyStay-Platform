import{v as a,x as e,u as t,V as s,T as n,S as r,A as c,_ as l,I as i,c as o,D as u,C as d,t as m,o as h,p as x,s as f,K as p,F as v,y as j,b as N}from"./vendors.0de7404b.js";import{r as g}from"./common.5c603857.js";var y=["\u6211\u60f3\u53bb\u5317\u4eac\u73a9\uff0c\u9884\u7b97\u4e0d\u9650\uff0c\u63a8\u8350\u8c6a\u534e\u9152\u5e97","\u5317\u4eac 400 \u5143\u4ee5\u5185\u6709\u4ec0\u4e48\u9152\u5e97\uff1f","\u8fd9\u4e2a\u9152\u5e97\u9644\u8fd1\u6709\u4ec0\u4e48\u666f\u70b9\uff1f"],b="https://images.unsplash.com/photo-1566073771259-6a8506099945";function w(a){return a?N(a).call(a,"http")?a:"http://1.14.207.212:8848".concat(a):b}function k(){var a;return l(a="msg-".concat(Date.now(),"-")).call(a,Math.floor(1e4*Math.random()))}function A(a){return{id:k(),role:"user",type:"text",text:a,structured:[],cards:[],createdAt:Date.now()}}function S(a){var e,t=(null===a||void 0===a?void 0:a.message)||{},s=t.type||"text",n=t.text||(null===a||void 0===a?void 0:a.content)||(null===a||void 0===a?void 0:a.reply)||"\u62b1\u6b49\uff0c\u6682\u65f6\u65e0\u6cd5\u56de\u7b54\u3002",r=Array.isArray(t.structured)?t.structured:[],l=Array.isArray(t.cards)?c(e=t.cards).call(e,function(a){return j(j({},a),{},{cover_image:w(a.cover_image)})}):[];return{id:k(),role:"assistant",type:s,text:n,structured:r,cards:l,createdAt:Date.now()}}function C(){var a,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c(a=o(e).call(e,-10)).call(a,function(a){return{role:"assistant"===a.role?"assistant":"user",content:a.text}})}function _(){var j=a.useState([{id:k(),role:"assistant",type:"text",text:"\u60a8\u597d\uff0c\u6211\u662f EasyStay \u667a\u80fd\u52a9\u624b\u3002\u544a\u8bc9\u6211\u57ce\u5e02\u3001\u9884\u7b97\u548c\u504f\u597d\uff0c\u6211\u4f1a\u57fa\u4e8e\u771f\u5b9e\u9152\u5e97\u6570\u636e\u63a8\u8350\uff1b\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u95ee\u201c\u8fd9\u4e2a\u9152\u5e97\u9644\u8fd1\u6709\u4ec0\u4e48\u666f\u70b9/\u7f8e\u98df/\u5730\u94c1\u201d\u3002",structured:[],cards:[],createdAt:Date.now()}]),N=e(j,2),b=N[0],w=N[1],_=a.useState({city:null,budgetIntent:null,travelPurpose:null,preferences:[],lastHotel:null,lastTool:null}),D=e(_,2),T=D[0],I=D[1],q=a.useState(""),E=e(q,2),F=E[0],M=E[1],P=a.useState(!1),V=e(P,2),B=V[0],H=V[1],K=a.useState(""),O=e(K,2),W=O[0],Y=O[1],z=function(a){w(function(e){var t;return l(t=[]).call(t,p(e),[a])}),Y(a.id)},G=function(a){var e=a.detail_path||"/pages/detail/index?id=".concat(a.id);m.navigateTo({url:e})},J=function(){m.navigateBack({fail:function(){m.switchTab({url:"/pages/index/index"})}})},L=function(){var a=h(x().m(function a(e){var t,s,n,r,c,i,o,u;return x().w(function(a){while(1)switch(a.p=a.n){case 0:if(n=v(t=String(e||"")).call(t),n&&!B){a.n=1;break}return a.a(2);case 1:return r=A(n),c=l(s=[]).call(s,p(b),[r]),z(r),M(""),H(!0),a.p=2,a.n=3,g({url:"/ai/chat",method:"POST",data:{message:n,history:C(c),sessionContext:T}});case 3:if(o=a.v,200===o.code){a.n=4;break}throw new Error(o.msg||"\u8bf7\u6c42\u5931\u8d25");case 4:u=S(o.data||{}),z(u),null!==(i=o.data)&&void 0!==i&&i.sessionContext&&I(o.data.sessionContext),a.n=6;break;case 5:a.p=5,a.v,f({title:"\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",icon:"none"}),z({id:k(),role:"assistant",type:"text",text:"\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",structured:[],cards:[],createdAt:Date.now()});case 6:return a.p=6,H(!1),a.f(6);case 7:return a.a(2)}},a,null,[[2,5,6,7]])}));return function(e){return a.apply(this,arguments)}}();return t.jsxs(s,{className:"ai-chat-page",children:[t.jsxs(s,{className:"chat-header",children:[t.jsx(n,{className:"back-btn",onClick:J,children:"\u2039"}),t.jsx(n,{className:"title",children:"EasyStay \u667a\u80fd\u52a9\u624b"})]}),t.jsxs(r,{className:"chat-content",scrollY:!0,scrollIntoView:W,scrollWithAnimation:!0,children:[c(b).call(b,function(a){var e,r;return t.jsxs(s,{id:a.id,className:"msg-row ".concat(a.role),children:[t.jsx(s,{className:"bubble",children:a.text}),a.structured&&a.structured.length>0&&t.jsx(s,{className:"structured-list",children:c(e=a.structured).call(e,function(e,s){var r;return t.jsx(n,{className:"structured-line",children:e},l(r="".concat(a.id,"-")).call(r,s))})}),"hotel_cards"===a.type&&a.cards&&a.cards.length>0&&t.jsx(s,{className:"card-list",children:c(r=a.cards).call(r,function(e){var r,d,m,h;return t.jsxs(s,{className:"hotel-card",children:[t.jsx(i,{className:"cover",src:e.cover_image,mode:"aspectFill"}),t.jsxs(s,{className:"card-body",children:[t.jsx(n,{className:"name",children:e.name}),t.jsxs(n,{className:"meta",children:[e.city," \xb7 ",e.star,"\u661f \xb7 \u8bc4\u5206 ",e.score]}),t.jsxs(n,{className:"price",children:["\xa5",e.price," \u8d77/\u665a"]}),t.jsx(s,{className:"tags",children:c(r=o(d=e.tags||[]).call(d,0,4)).call(r,function(a){var s;return t.jsx(n,{className:"tag",children:a},l(s="".concat(e.id,"-")).call(s,a))})}),t.jsxs(n,{className:"reason",children:["\u4eae\u70b9\uff1a",e.recommend_reason]}),t.jsx(u,{className:"detail-btn",onClick:function(){return G(e)},children:"\u67e5\u770b\u8be6\u60c5"})]})]},l(m=l(h="".concat(a.id,"-")).call(h,e.id,"-")).call(m,e.name))})})]},a.id)}),B&&t.jsx(s,{className:"msg-row assistant",children:t.jsx(s,{className:"bubble",children:"\u6b63\u5728\u4e3a\u60a8\u67e5\u8be2\u4e2d..."})})]}),t.jsx(s,{className:"quick-questions",children:c(y).call(y,function(a){return t.jsx(s,{className:"quick-item",onClick:function(){return L(a)},children:t.jsx(n,{children:a})},a)})}),t.jsxs(s,{className:"input-bar",children:[t.jsx(d,{className:"input",value:F,onInput:function(a){return M(a.detail.value)},placeholder:"\u544a\u8bc9\u6211\uff1a\u57ce\u5e02 + \u9884\u7b97 + \u504f\u597d\uff0c\u6216\u95ee\u9644\u8fd1\u4fe1\u606f",confirmType:"send",onConfirm:function(){return L(F)}}),t.jsx(u,{className:"send-btn",onClick:function(){return L(F)},loading:B,children:"\u53d1\u9001"})]})]})}export{_ as default};
