import{t as a,q as e,v as s,u as n,p as c,V as t,T as l,S as i,x as r,y as o,z as d,I as u,O as m,L as h,_ as f,K as p,D as g,Q as v,m as x,n as N,s as j,E as y,F as k,N as b,g as w,w as D}from"./vendors.5d021e99.js";import{r as C}from"./common.7dfb5deb.js";var I=function(){var I,F,O,S,Y=a.useRouter(),M=e.useState(!0),T=s(M,2),_=T[0],A=T[1],R=e.useState(null),E=s(R,2),J=E[0],L=E[1],P=e.useState([]),U=s(P,2),q=U[0],z=U[1],B="http://localhost:3000",K=e.useState(!1),Q=s(K,2),V=Q[0],X=Q[1],G=e.useState({checkIn:"",checkOut:"",nightCount:1}),H=s(G,2),W=H[0],Z=H[1],$=e.useState(null),aa=s($,2),ea=aa[0],sa=aa[1],na=function(a,e){var s,n,c=(new Date).getFullYear(),t=f(s=f(n="".concat(c,"/")).call(n,(new Date).getMonth()+1,"/")).call(s,(new Date).getDate()),l=function(a){if(!a||"string"!==typeof a||!y(a).call(a,"\u6708"))return t;try{var e,s,n,l,i,r=k(e=a.replace("\u6708","/").replace("\u65e5","")).call(e),o=r.split("/");if(o.length<2)return t;var d=b(s=o[0]).call(s,2,"0"),u=b(n=o[1]).call(n,2,"0");return f(l=f(i="".concat(c,"/")).call(i,d,"/")).call(l,u)}catch(m){return t}},i=new Date(l(a)),r=new Date(l(e));if(isNaN(i.getTime())||isNaN(r.getTime()))return 1;var o=Math.ceil((r-i)/864e5);return o>0?o:1};e.useEffect(function(){var a=Y.params,e=a.id,s=a.checkIn,c=a.checkOut,t=s?decodeURIComponent(s):n().format("M\u6708D\u65e5"),l=c?decodeURIComponent(c):n().add(1,"day").format("M\u6708D\u65e5");Z({checkIn:t,checkOut:l,nightCount:na(t,l)}),e&&la(e)},[Y.params]);var ca=function(a){var e,s,c,t,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=n().add(l,"day").format("YYYY-MM-DD");if(!a||"string"!==typeof a)return i;var r=a.match(/(\d{1,2})\u6708(\d{1,2})\u65e5/);if(!r)return i;var o=n().year(),d=b(e=r[1]).call(e,2,"0"),u=b(s=r[2]).call(s,2,"0");return n(f(c=f(t="".concat(o,"-")).call(t,d,"-")).call(c,u)).format("YYYY-MM-DD")},ta=function(){var e=x(N().m(function e(s){var n,c,t;return N().w(function(e){while(1)switch(e.p=e.n){case 0:if(n=w("token"),n){e.n=1;break}return a.navigateTo({url:"/pages/login/index?redirect=/pages/order/index"}),e.a(2);case 1:if(null!==J&&void 0!==J&&J.id&&null!==s&&void 0!==s&&s.id){e.n=2;break}return j({title:"\u4e0b\u5355\u53c2\u6570\u5f02\u5e38",icon:"none"}),e.a(2);case 2:return sa(s.id),e.p=3,e.n=4,C({url:"/order/create",method:"POST",data:{hotel_id:J.id,room_type_id:s.id,check_in:ca(W.checkIn,0),check_out:ca(W.checkOut,1)}});case 4:c=e.v,200===c.code?(j({title:"\u4e0b\u5355\u6210\u529f",icon:"success"}),a.switchTab({url:"/pages/order/index"})):j({title:c.msg||"\u4e0b\u5355\u5931\u8d25",icon:"none"}),e.n=6;break;case 5:e.p=5,t=e.v,j({title:(null===t||void 0===t?void 0:t.msg)||"\u4e0b\u5355\u5931\u8d25",icon:"none"});case 6:return e.p=6,sa(null),e.f(6);case 7:return e.a(2)}},e,null,[[3,5,6,7]])}));return function(a){return e.apply(this,arguments)}}(),la=function(){var a=x(N().m(function a(e){var s,n,c,t,l;return N().w(function(a){while(1)switch(a.p=a.n){case 0:return A(!0),a.p=1,a.n=2,C({url:"/hotel/detail/".concat(e)});case 2:return s=a.v,a.n=3,C({url:"/hotel/roomtype/list",data:{hotel_id:e}});case 3:if(n=a.v,200===s.code&&s.data){if(c=s.data,t=[],c.images)try{l="string"===typeof c.images?JSON.parse(c.images):c.images,t=Array.isArray(l)?l:[]}catch(i){t=[]}L(D(D({},c),{},{displayImages:o(t).call(t,function(a){var e;return h(a).call(a,"http")?a:f(e="".concat(B)).call(e,a)}),displayFacilities:c.facilities?"string"===typeof c.facilities?JSON.parse(c.facilities):c.facilities:[]}))}200===n.code&&Array.isArray(n.data)&&z(n.data),a.n=5;break;case 4:a.p=4,a.v,j({title:"\u83b7\u53d6\u8be6\u60c5\u5931\u8d25",icon:"none"});case 5:return a.p=5,A(!1),a.f(5);case 6:return a.a(2)}},a,null,[[1,4,5,6]])}));return function(e){return a.apply(this,arguments)}}(),ia=function(){var e=a.getCurrentPages();e.length>1?a.navigateBack():a.switchTab({url:"/pages/list/index"}).catch(function(){a.reLaunch({url:"/pages/list/index"})})};return _?c.jsx(t,{className:"loading-container",children:c.jsx(l,{children:"\u6b63\u5728\u52a0\u8f7d\u9152\u5e97\u8be6\u60c5..."})}):c.jsxs(t,{className:"detail-page",children:[c.jsxs(t,{className:"custom-nav",children:[c.jsx(t,{className:"back-icon",onClick:ia,children:"\u2190"}),c.jsx(l,{className:"nav-title",children:(null===J||void 0===J?void 0:J.name)||"\u9152\u5e97\u8be6\u60c5"})]}),c.jsxs(i,{scrollY:!0,className:"scroll-content",style:{height:"100vh"},children:[c.jsx(t,{className:"banner-area",children:null!==J&&void 0!==J&&J.displayImages&&J.displayImages.length>0?c.jsx(r,{className:"banner-swiper",circular:!0,indicatorDots:!0,indicatorActiveColor:"#2563eb",children:o(I=J.displayImages).call(I,function(a,e){return c.jsx(d,{children:c.jsx(u,{src:a,mode:"aspectFill",className:"banner-image"})},e)})}):c.jsx(t,{className:"no-img",children:"\u6682\u65e0\u56fe\u7247"})}),c.jsxs(t,{className:"info-card",children:[c.jsx(l,{className:"name",children:null===J||void 0===J?void 0:J.name}),(null===J||void 0===J?void 0:J.star)&&c.jsxs(t,{className:"star-bar",children:[c.jsx(l,{className:"star-text",children:m(F="\u2605").call(F,J.star)}),c.jsxs(l,{className:"star-label",children:[J.star,"\u661f\u7ea7\u9152\u5e97"]})]}),c.jsxs(t,{className:"address-bar",children:["\u4f4d\u7f6e: ",null===J||void 0===J?void 0:J.address]}),(null===J||void 0===J?void 0:J.displayFacilities)&&J.displayFacilities.length>0&&c.jsxs(c.Fragment,{children:[c.jsx(t,{className:"section-title",children:"\u9152\u5e97\u8bbe\u65bd"}),c.jsx(i,{scrollX:!0,className:"facility-scroll",children:o(O=J.displayFacilities).call(O,function(a,e){return c.jsx(t,{className:"facility-item",children:c.jsx(l,{className:"f-name",children:"string"===typeof a?a:a.name})},e)})})]})]}),c.jsx(t,{className:"calendar-bar",onClick:function(){return X(!0)},children:c.jsxs(t,{className:"inner",children:[c.jsx(t,{className:"date-item",children:c.jsx(t,{className:"date",children:W.checkIn})}),c.jsxs(t,{className:"night-count",children:[W.nightCount,"\u665a"]}),c.jsx(t,{className:"date-item",children:c.jsx(t,{className:"date",children:W.checkOut})})]})}),c.jsx(t,{className:"room-list",children:o(S=q||[]).call(S,function(a){var e,s;return c.jsxs(t,{className:"room-card",children:[c.jsx(u,{src:a.image?h(e=a.image).call(e,"http")?a.image:f(s="".concat(B)).call(s,a.image):"",className:"room-img",mode:"aspectFill"}),c.jsxs(t,{className:"room-info",children:[c.jsx(l,{className:"r-name",children:a.name}),c.jsxs(t,{className:"r-bottom",children:[c.jsxs(l,{className:"price",children:["\xa5",p(a.price).toFixed(0)]}),c.jsx(t,{className:"btn-book",onClick:function(){return ta(a)},children:ea===a.id?"\u9884\u8ba2\u4e2d...":"\u9884\u8ba2"})]})]})]},a.id)})})]}),c.jsx(g,{visible:V,type:"range",onClose:function(){return X(!1)},onConfirm:function(a){var e,s,n=f(e="".concat(v(a[0][1]),"\u6708")).call(e,v(a[0][2]),"\u65e5"),c=f(s="".concat(v(a[1][1]),"\u6708")).call(s,v(a[1][2]),"\u65e5");Z({checkIn:n,checkOut:c,nightCount:na(n,c)}),X(!1)}})]})};export{I as default};
