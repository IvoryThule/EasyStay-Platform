import{t as e,q as a,v as s,u as n,p as c,V as t,T as l,S as i,x as r,y as o,z as d,I as u,O as m,Q as h,L as f,_ as g,K as p,D as x,U as v,m as N,n as j,s as y,E as k,F as b,N as w,g as I,w as C}from"./vendors.789133a4.js";import{r as D}from"./common.25fc12b7.js";var F=function(){var F,O,S,Y,_=e.useRouter(),M=a.useState(!0),T=s(M,2),A=T[0],P=T[1],R=a.useState(null),U=s(R,2),E=U[0],J=U[1],L=a.useState([]),q=s(L,2),z=q[0],B=q[1],K="http://1.14.207.212:8848",Q=a.useState(!1),V=s(Q,2),X=V[0],G=V[1],H=a.useState({checkIn:"",checkOut:"",nightCount:1}),W=s(H,2),Z=W[0],$=W[1],ee=a.useState(null),ae=s(ee,2),se=ae[0],ne=ae[1],ce=function(e,a){var s,n,c=(new Date).getFullYear(),t=g(s=g(n="".concat(c,"/")).call(n,(new Date).getMonth()+1,"/")).call(s,(new Date).getDate()),l=function(e){if(!e||"string"!==typeof e||!k(e).call(e,"\u6708"))return t;try{var a,s,n,l,i,r=b(a=e.replace("\u6708","/").replace("\u65e5","")).call(a),o=r.split("/");if(o.length<2)return t;var d=w(s=o[0]).call(s,2,"0"),u=w(n=o[1]).call(n,2,"0");return g(l=g(i="".concat(c,"/")).call(i,d,"/")).call(l,u)}catch(m){return t}},i=new Date(l(e)),r=new Date(l(a));if(isNaN(i.getTime())||isNaN(r.getTime()))return 1;var o=Math.ceil((r-i)/864e5);return o>0?o:1};a.useEffect(function(){var e=_.params,a=e.id,s=e.checkIn,c=e.checkOut,t=s?decodeURIComponent(s):n().format("M\u6708D\u65e5"),l=c?decodeURIComponent(c):n().add(1,"day").format("M\u6708D\u65e5");$({checkIn:t,checkOut:l,nightCount:ce(t,l)}),a&&ie(a)},[_.params]);var te=function(e){var a,s,c,t,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=n().add(l,"day").format("YYYY-MM-DD");if(!e||"string"!==typeof e)return i;var r=e.match(/(\d{1,2})\u6708(\d{1,2})\u65e5/);if(!r)return i;var o=n().year(),d=w(a=r[1]).call(a,2,"0"),u=w(s=r[2]).call(s,2,"0");return n(g(c=g(t="".concat(o,"-")).call(t,d,"-")).call(c,u)).format("YYYY-MM-DD")},le=function(){var a=N(j().m(function a(s){var n,c,t;return j().w(function(a){while(1)switch(a.p=a.n){case 0:if(n=I("token"),n){a.n=1;break}return e.navigateTo({url:"/pages/login/index?redirect=/pages/order/index"}),a.a(2);case 1:if(null!==E&&void 0!==E&&E.id&&null!==s&&void 0!==s&&s.id){a.n=2;break}return y({title:"\u4e0b\u5355\u53c2\u6570\u5f02\u5e38",icon:"none"}),a.a(2);case 2:return ne(s.id),a.p=3,a.n=4,D({url:"/order/create",method:"POST",data:{hotel_id:E.id,room_type_id:s.id,check_in:te(Z.checkIn,0),check_out:te(Z.checkOut,1)}});case 4:c=a.v,200===c.code?(y({title:"\u4e0b\u5355\u6210\u529f",icon:"success"}),e.switchTab({url:"/pages/order/index"})):y({title:c.msg||"\u4e0b\u5355\u5931\u8d25",icon:"none"}),a.n=6;break;case 5:a.p=5,t=a.v,y({title:(null===t||void 0===t?void 0:t.msg)||"\u4e0b\u5355\u5931\u8d25",icon:"none"});case 6:return a.p=6,ne(null),a.f(6);case 7:return a.a(2)}},a,null,[[3,5,6,7]])}));return function(e){return a.apply(this,arguments)}}(),ie=function(){var e=N(j().m(function e(a){var s,n,c,t,l,i;return j().w(function(e){while(1)switch(e.p=e.n){case 0:return P(!0),e.p=1,e.n=2,D({url:"/hotel/detail/".concat(a)});case 2:return s=e.v,e.n=3,D({url:"/hotel/roomtype/list",data:{hotel_id:a}});case 3:if(n=e.v,200===s.code&&s.data){if(c=s.data,t=[],c.images)try{l=c.images,i="string"===typeof l?JSON.parse(l):l,Array.isArray(i)&&i.length>0&&(t=i)}catch(r){console.error("Parse images failed",r)}0===t.length&&c.cover_image&&(t=[c.cover_image]),0===t.length&&(t=["https://dummyimage.com/750x400/cccccc/ffffff&text=No+Image"]),J(C(C({},c),{},{displayImages:o(t).call(t,function(e){var a;return f(e).call(e,"http")?e:g(a="".concat(K)).call(a,e)}),displayFacilities:c.facilities?"string"===typeof c.facilities?JSON.parse(c.facilities):c.facilities:[]}))}200===n.code&&Array.isArray(n.data)&&B(n.data),e.n=5;break;case 4:e.p=4,e.v,y({title:"\u83b7\u53d6\u8be6\u60c5\u5931\u8d25",icon:"none"});case 5:return e.p=5,P(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(a){return e.apply(this,arguments)}}(),re=function(){var a=e.getCurrentPages();a.length>1?e.navigateBack():e.switchTab({url:"/pages/list/index"}).catch(function(){e.reLaunch({url:"/pages/list/index"})})};return A?c.jsx(t,{className:"loading-container",children:c.jsx(l,{children:"\u6b63\u5728\u52a0\u8f7d\u9152\u5e97\u8be6\u60c5..."})}):c.jsxs(t,{className:"detail-page",children:[c.jsxs(t,{className:"custom-nav",children:[c.jsx(t,{className:"back-icon",onClick:re,children:"\u2190"}),c.jsx(l,{className:"nav-title",children:(null===E||void 0===E?void 0:E.name)||"\u9152\u5e97\u8be6\u60c5"})]}),c.jsxs(i,{scrollY:!0,className:"scroll-content",style:{height:"100vh"},children:[c.jsx(t,{className:"banner-area",children:null!==E&&void 0!==E&&E.displayImages&&E.displayImages.length>0?c.jsx(r,{className:"banner-swiper",circular:!0,indicatorDots:!0,indicatorActiveColor:"#2563eb",autoplay:!0,interval:4e3,children:o(F=E.displayImages).call(F,function(e,a){return c.jsx(d,{children:c.jsx(u,{src:e,mode:"aspectFill",className:"banner-image",onClick:function(){m({urls:E.displayImages,current:e})}})},a)})}):c.jsx(t,{className:"no-img",children:"\u6682\u65e0\u56fe\u7247"})}),"    ",c.jsxs(t,{className:"info-card",children:[c.jsx(l,{className:"name",children:null===E||void 0===E?void 0:E.name}),(null===E||void 0===E?void 0:E.star)&&c.jsxs(t,{className:"star-bar",children:[c.jsx(l,{className:"star-text",children:h(O="\u2605").call(O,E.star)}),c.jsxs(l,{className:"star-label",children:[E.star,"\u661f\u7ea7\u9152\u5e97"]})]}),c.jsxs(t,{className:"address-bar",children:["\u4f4d\u7f6e: ",null===E||void 0===E?void 0:E.address]}),(null===E||void 0===E?void 0:E.displayFacilities)&&E.displayFacilities.length>0&&c.jsxs(c.Fragment,{children:[c.jsx(t,{className:"section-title",children:"\u9152\u5e97\u8bbe\u65bd"}),c.jsx(i,{scrollX:!0,className:"facility-scroll",children:o(S=E.displayFacilities).call(S,function(e,a){return c.jsx(t,{className:"facility-item",children:c.jsx(l,{className:"f-name",children:"string"===typeof e?e:e.name})},a)})})]})]}),c.jsx(t,{className:"calendar-bar",onClick:function(){return G(!0)},children:c.jsxs(t,{className:"inner",children:[c.jsx(t,{className:"date-item",children:c.jsx(t,{className:"date",children:Z.checkIn})}),c.jsxs(t,{className:"night-count",children:[Z.nightCount,"\u665a"]}),c.jsx(t,{className:"date-item",children:c.jsx(t,{className:"date",children:Z.checkOut})})]})}),c.jsx(t,{className:"section-title",style:{padding:"0 30px",margin:"20px 0 10px"},children:"\u9884\u8ba2\u623f\u578b"}),c.jsx(t,{className:"room-list",children:o(Y=z||[]).call(Y,function(e){var a,s;return c.jsxs(t,{className:"room-card",children:[c.jsx(u,{src:e.image?f(a=e.image).call(a,"http")?e.image:g(s="".concat(K)).call(s,e.image):"",className:"room-img",mode:"aspectFill"}),c.jsxs(t,{className:"room-info",children:[c.jsx(l,{className:"r-name",children:e.name}),c.jsxs(t,{className:"r-bottom",children:[c.jsxs(l,{className:"price",children:["\xa5",p(e.price).toFixed(0)]}),c.jsx(t,{className:"btn-book",onClick:function(){return le(e)},children:se===e.id?"\u9884\u8ba2\u4e2d...":"\u9884\u8ba2"})]})]})]},e.id)})})]}),c.jsx(x,{visible:X,type:"range",onClose:function(){return G(!1)},onConfirm:function(e){var a,s,n=g(a="".concat(v(e[0][1]),"\u6708")).call(a,v(e[0][2]),"\u65e5"),c=g(s="".concat(v(e[1][1]),"\u6708")).call(s,v(e[1][2]),"\u65e5");$({checkIn:n,checkOut:c,nightCount:ce(n,c)}),G(!1)}})]})};export{F as default};
