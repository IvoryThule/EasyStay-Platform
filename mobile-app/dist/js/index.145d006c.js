import{t as e,v as a,x as s,w as c,u as n,V as t,T as l,S as i,z as r,A as o,B as d,I as u,Z as m,$ as h,b as f,_ as g,M as p,E as x,a0 as v,o as N,p as j,s as y,G as k,F as b,Y as w,g as I,y as C}from"./vendors.8928da7e.js";import{r as D}from"./common.0834f2a9.js";var Y=function(){var Y,F,S,M,O=e.useRouter(),_=a.useState(!0),T=s(_,2),A=T[0],P=T[1],R=a.useState(null),B=s(R,2),E=B[0],J=B[1],U=a.useState([]),z=s(U,2),G=z[0],L=z[1],V="http://1.14.207.212:8848",X=a.useState(!1),Z=s(X,2),$=Z[0],q=Z[1],H=a.useState({checkIn:"",checkOut:"",nightCount:1}),K=s(H,2),Q=K[0],W=K[1],ee=a.useState(null),ae=s(ee,2),se=ae[0],ce=ae[1],ne=function(e,a){var s,c,n=(new Date).getFullYear(),t=g(s=g(c="".concat(n,"/")).call(c,(new Date).getMonth()+1,"/")).call(s,(new Date).getDate()),l=function(e){if(!e||"string"!==typeof e||!k(e).call(e,"\u6708"))return t;try{var a,s,c,l,i,r=b(a=e.replace("\u6708","/").replace("\u65e5","")).call(a),o=r.split("/");if(o.length<2)return t;var d=w(s=o[0]).call(s,2,"0"),u=w(c=o[1]).call(c,2,"0");return g(l=g(i="".concat(n,"/")).call(i,d,"/")).call(l,u)}catch(m){return t}},i=new Date(l(e)),r=new Date(l(a));if(isNaN(i.getTime())||isNaN(r.getTime()))return 1;var o=Math.ceil((r-i)/864e5);return o>0?o:1};a.useEffect(function(){var e=O.params,a=e.id,s=e.checkIn,n=e.checkOut,t=s?decodeURIComponent(s):c().format("M\u6708D\u65e5"),l=n?decodeURIComponent(n):c().add(1,"day").format("M\u6708D\u65e5");W({checkIn:t,checkOut:l,nightCount:ne(t,l)}),a&&ie(a)},[O.params]);var te=function(e){var a,s,n,t,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=c().add(l,"day").format("YYYY-MM-DD");if(!e||"string"!==typeof e)return i;var r=e.match(/(\d{1,2})\u6708(\d{1,2})\u65e5/);if(!r)return i;var o=c().year(),d=w(a=r[1]).call(a,2,"0"),u=w(s=r[2]).call(s,2,"0");return c(g(n=g(t="".concat(o,"-")).call(t,d,"-")).call(n,u)).format("YYYY-MM-DD")},le=function(){var a=N(j().m(function a(s){var c,n,t;return j().w(function(a){while(1)switch(a.p=a.n){case 0:if(c=I("token"),c){a.n=1;break}return e.navigateTo({url:"/pages/login/index?redirect=/pages/order/index"}),a.a(2);case 1:if(null!==E&&void 0!==E&&E.id&&null!==s&&void 0!==s&&s.id){a.n=2;break}return y({title:"\u4e0b\u5355\u53c2\u6570\u5f02\u5e38",icon:"none"}),a.a(2);case 2:return ce(s.id),a.p=3,a.n=4,D({url:"/order/create",method:"POST",data:{hotel_id:E.id,room_type_id:s.id,check_in:te(Q.checkIn,0),check_out:te(Q.checkOut,1)}});case 4:n=a.v,200===n.code?(y({title:"\u4e0b\u5355\u6210\u529f",icon:"success"}),e.switchTab({url:"/pages/order/index"})):y({title:n.msg||"\u4e0b\u5355\u5931\u8d25",icon:"none"}),a.n=6;break;case 5:a.p=5,t=a.v,y({title:(null===t||void 0===t?void 0:t.msg)||"\u4e0b\u5355\u5931\u8d25",icon:"none"});case 6:return a.p=6,ce(null),a.f(6);case 7:return a.a(2)}},a,null,[[3,5,6,7]])}));return function(e){return a.apply(this,arguments)}}(),ie=function(){var e=N(j().m(function e(a){var s,c,n,t,l,i;return j().w(function(e){while(1)switch(e.p=e.n){case 0:return P(!0),e.p=1,e.n=2,D({url:"/hotel/detail/".concat(a)});case 2:return s=e.v,e.n=3,D({url:"/hotel/roomtype/list",data:{hotel_id:a}});case 3:if(c=e.v,200===s.code&&s.data){if(n=s.data,t=[],n.images)try{l=n.images,i="string"===typeof l?JSON.parse(l):l,Array.isArray(i)&&i.length>0&&(t=i)}catch(r){console.error("Parse images failed",r)}0===t.length&&n.cover_image&&(t=[n.cover_image]),0===t.length&&(t=["https://dummyimage.com/750x400/cccccc/ffffff&text=No+Image"]),J(C(C({},n),{},{displayImages:o(t).call(t,function(e){var a;return f(e).call(e,"http")?e:g(a="".concat(V)).call(a,e)}),displayFacilities:n.facilities?"string"===typeof n.facilities?JSON.parse(n.facilities):n.facilities:[]}))}200===c.code&&Array.isArray(c.data)&&L(c.data),e.n=5;break;case 4:e.p=4,e.v,y({title:"\u83b7\u53d6\u8be6\u60c5\u5931\u8d25",icon:"none"});case 5:return e.p=5,P(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(a){return e.apply(this,arguments)}}(),re=function(){var a=e.getCurrentPages();a.length>1?e.navigateBack():e.switchTab({url:"/pages/list/index"}).catch(function(){e.reLaunch({url:"/pages/list/index"})})};return A?n.jsx(t,{className:"loading-container",children:n.jsx(l,{children:"\u6b63\u5728\u52a0\u8f7d\u9152\u5e97\u8be6\u60c5..."})}):n.jsxs(t,{className:"detail-page",children:[n.jsxs(t,{className:"custom-nav",children:[n.jsx(t,{className:"back-icon",onClick:re,children:"\u2190"}),n.jsx(l,{className:"nav-title",children:(null===E||void 0===E?void 0:E.name)||"\u9152\u5e97\u8be6\u60c5"})]}),n.jsxs(i,{scrollY:!0,className:"scroll-content",style:{height:"100vh"},children:[n.jsx(t,{className:"banner-area",children:null!==E&&void 0!==E&&E.displayImages&&E.displayImages.length>0?n.jsx(r,{className:"banner-swiper",circular:!0,indicatorDots:!0,indicatorActiveColor:"#2563eb",autoplay:!0,interval:4e3,children:o(Y=E.displayImages).call(Y,function(e,a){return n.jsx(d,{children:n.jsx(u,{src:e,mode:"aspectFill",className:"banner-image",onClick:function(){m({urls:E.displayImages,current:e})}})},a)})}):n.jsx(t,{className:"no-img",children:"\u6682\u65e0\u56fe\u7247"})}),"    ",n.jsxs(t,{className:"info-card",children:[n.jsx(l,{className:"name",children:null===E||void 0===E?void 0:E.name}),(null===E||void 0===E?void 0:E.star)&&n.jsxs(t,{className:"star-bar",children:[n.jsx(l,{className:"star-text",children:h(F="\u2605").call(F,E.star)}),n.jsxs(l,{className:"star-label",children:[E.star,"\u661f\u7ea7\u9152\u5e97"]})]}),n.jsxs(t,{className:"address-bar",children:["\u4f4d\u7f6e: ",null===E||void 0===E?void 0:E.address]}),(null===E||void 0===E?void 0:E.displayFacilities)&&E.displayFacilities.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(t,{className:"section-title",children:"\u9152\u5e97\u8bbe\u65bd"}),n.jsx(i,{scrollX:!0,className:"facility-scroll",children:o(S=E.displayFacilities).call(S,function(e,a){return n.jsx(t,{className:"facility-item",children:n.jsx(l,{className:"f-name",children:"string"===typeof e?e:e.name})},a)})})]})]}),n.jsx(t,{className:"calendar-bar",onClick:function(){return q(!0)},children:n.jsxs(t,{className:"inner",children:[n.jsx(t,{className:"date-item",children:n.jsx(t,{className:"date",children:Q.checkIn})}),n.jsxs(t,{className:"night-count",children:[Q.nightCount,"\u665a"]}),n.jsx(t,{className:"date-item",children:n.jsx(t,{className:"date",children:Q.checkOut})})]})}),n.jsx(t,{className:"section-title",style:{padding:"0 30px",margin:"20px 0 10px"},children:"\u9884\u8ba2\u623f\u578b"}),n.jsx(t,{className:"room-list",children:o(M=G||[]).call(M,function(e){var a,s;return n.jsxs(t,{className:"room-card",children:[n.jsx(u,{src:e.image?f(a=e.image).call(a,"http")?e.image:g(s="".concat(V)).call(s,e.image):"",className:"room-img",mode:"aspectFill"}),n.jsxs(t,{className:"room-info",children:[n.jsx(l,{className:"r-name",children:e.name}),n.jsxs(t,{className:"r-bottom",children:[n.jsxs(l,{className:"price",children:["\xa5",p(e.price).toFixed(0)]}),n.jsx(t,{className:"btn-book",onClick:function(){return le(e)},children:se===e.id?"\u9884\u8ba2\u4e2d...":"\u9884\u8ba2"})]})]})]},e.id)})})]}),n.jsx(x,{visible:$,type:"range",onClose:function(){return q(!1)},onConfirm:function(e){var a,s,c=g(a="".concat(v(e[0][1]),"\u6708")).call(a,v(e[0][2]),"\u65e5"),n=g(s="".concat(v(e[1][1]),"\u6708")).call(s,v(e[1][2]),"\u65e5");W({checkIn:c,checkOut:n,nightCount:ne(c,n)}),q(!1)}})]})};export{Y as default};
