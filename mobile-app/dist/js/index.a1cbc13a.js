import{q as a,v as e,p as t,V as s,T as r,t as n,S as c,y as l,_ as i,I as o,C as u,B as d,A as m,m as h,n as x,s as f,J as p,F as v,w as j,L as N}from"./vendors.5d021e99.js";import{r as g}from"./common.7dfb5deb.js";var y=["\u6211\u60f3\u53bb\u5317\u4eac\u73a9\uff0c\u9884\u7b97\u4e0d\u9650\uff0c\u63a8\u8350\u8c6a\u534e\u9152\u5e97","\u5317\u4eac 400 \u5143\u4ee5\u5185\u6709\u4ec0\u4e48\u9152\u5e97\uff1f","\u6211\u53bb\u4e0a\u6d77\u51fa\u5dee\uff0c\u63a8\u8350\u4ea4\u901a\u65b9\u4fbf\u7684\u9152\u5e97"],b="https://images.unsplash.com/photo-1566073771259-6a8506099945";function w(a){return a?N(a).call(a,"http")?a:"http://localhost:3000".concat(a):b}function k(){var a;return i(a="msg-".concat(Date.now(),"-")).call(a,Math.floor(1e4*Math.random()))}function A(a){return{id:k(),role:"user",type:"text",text:a,structured:[],cards:[],createdAt:Date.now()}}function S(a){var e,t=(null===a||void 0===a?void 0:a.message)||{},s=t.type||"text",r=t.text||(null===a||void 0===a?void 0:a.content)||(null===a||void 0===a?void 0:a.reply)||"\u62b1\u6b49\uff0c\u6682\u65f6\u65e0\u6cd5\u56de\u7b54\u3002",n=Array.isArray(t.structured)?t.structured:[],c=Array.isArray(t.cards)?l(e=t.cards).call(e,function(a){return j(j({},a),{},{cover_image:w(a.cover_image)})}):[];return{id:k(),role:"assistant",type:s,text:r,structured:n,cards:c,createdAt:Date.now()}}function C(){var a,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(a=u(e).call(e,-10)).call(a,function(a){return{role:"assistant"===a.role?"assistant":"user",content:a.text}})}function _(){var j=a.useState([{id:k(),role:"assistant",type:"text",text:"\u60a8\u597d\uff0c\u6211\u662f EasyStay \u667a\u80fd\u52a9\u624b\u3002\u544a\u8bc9\u6211\u57ce\u5e02\u3001\u9884\u7b97\u548c\u504f\u597d\uff0c\u6211\u4f1a\u57fa\u4e8e\u771f\u5b9e\u5e93\u5185\u9152\u5e97\u63a8\u8350\u3002",structured:[],cards:[],createdAt:Date.now()}]),N=e(j,2),b=N[0],w=N[1],_=a.useState({city:null,budgetIntent:null,travelPurpose:null,preferences:[]}),D=e(_,2),q=D[0],I=D[1],T=a.useState(""),E=e(T,2),B=E[0],F=E[1],M=a.useState(!1),P=e(M,2),V=P[0],J=P[1],L=a.useState(""),O=e(L,2),W=O[0],Y=O[1],z=function(a){w(function(e){var t;return i(t=[]).call(t,p(e),[a])}),Y(a.id)},G=function(a){var e=a.detail_path||"/pages/detail/index?id=".concat(a.id);n.navigateTo({url:e})},H=function(){var a=h(x().m(function a(e){var t,s,r,n,c,l,o,u;return x().w(function(a){while(1)switch(a.p=a.n){case 0:if(r=v(t=String(e||"")).call(t),r&&!V){a.n=1;break}return a.a(2);case 1:return n=A(r),c=i(s=[]).call(s,p(b),[n]),z(n),F(""),J(!0),a.p=2,a.n=3,g({url:"/ai/chat",method:"POST",data:{message:r,history:C(c),sessionContext:q}});case 3:if(o=a.v,200===o.code){a.n=4;break}throw new Error(o.msg||"\u8bf7\u6c42\u5931\u8d25");case 4:u=S(o.data||{}),z(u),null!==(l=o.data)&&void 0!==l&&l.sessionContext&&I(o.data.sessionContext),a.n=6;break;case 5:a.p=5,a.v,f({title:"\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",icon:"none"}),z({id:k(),role:"assistant",type:"text",text:"\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002",structured:[],cards:[],createdAt:Date.now()});case 6:return a.p=6,J(!1),a.f(6);case 7:return a.a(2)}},a,null,[[2,5,6,7]])}));return function(e){return a.apply(this,arguments)}}();return t.jsxs(s,{className:"ai-chat-page",children:[t.jsxs(s,{className:"chat-header",children:[t.jsx(r,{className:"back-btn",onClick:function(){return n.navigateBack()},children:"\u2039"}),t.jsx(r,{className:"title",children:"EasyStay \u667a\u80fd\u52a9\u624b"})]}),t.jsxs(c,{className:"chat-content",scrollY:!0,scrollIntoView:W,scrollWithAnimation:!0,children:[l(b).call(b,function(a){var e,n;return t.jsxs(s,{id:a.id,className:"msg-row ".concat(a.role),children:[t.jsx(s,{className:"bubble",children:a.text}),a.structured&&a.structured.length>0&&t.jsx(s,{className:"structured-list",children:l(e=a.structured).call(e,function(e,s){var n;return t.jsx(r,{className:"structured-line",children:e},i(n="".concat(a.id,"-")).call(n,s))})}),"hotel_cards"===a.type&&a.cards&&a.cards.length>0&&t.jsx(s,{className:"card-list",children:l(n=a.cards).call(n,function(e){var n,c,m,h;return t.jsxs(s,{className:"hotel-card",children:[t.jsx(o,{className:"cover",src:e.cover_image,mode:"aspectFill"}),t.jsxs(s,{className:"card-body",children:[t.jsx(r,{className:"name",children:e.name}),t.jsxs(r,{className:"meta",children:[e.city," \xb7 ",e.star,"\u661f \xb7 \u8bc4\u5206 ",e.score]}),t.jsxs(r,{className:"price",children:["\xa5",e.price," \u8d77/\u665a"]}),t.jsx(s,{className:"tags",children:l(n=u(c=e.tags||[]).call(c,0,4)).call(n,function(a){var s;return t.jsx(r,{className:"tag",children:a},i(s="".concat(e.id,"-")).call(s,a))})}),t.jsxs(r,{className:"reason",children:["\u4eae\u70b9\uff1a",e.recommend_reason]}),t.jsx(d,{className:"detail-btn",onClick:function(){return G(e)},children:"\u67e5\u770b\u8be6\u60c5"})]})]},i(m=i(h="".concat(a.id,"-")).call(h,e.id,"-")).call(m,e.name))})})]},a.id)}),V&&t.jsx(s,{className:"msg-row assistant",children:t.jsx(s,{className:"bubble",children:"\u6b63\u5728\u4e3a\u60a8\u68c0\u7d22\u771f\u5b9e\u9152\u5e97\u6570\u636e..."})})]}),t.jsx(s,{className:"quick-questions",children:l(y).call(y,function(a){return t.jsx(s,{className:"quick-item",onClick:function(){return H(a)},children:t.jsx(r,{children:a})},a)})}),t.jsxs(s,{className:"input-bar",children:[t.jsx(m,{className:"input",value:B,onInput:function(a){return F(a.detail.value)},placeholder:"\u544a\u8bc9\u6211\uff1a\u57ce\u5e02 + \u9884\u7b97 + \u504f\u597d",confirmType:"send",onConfirm:function(){return H(B)}}),t.jsx(d,{className:"send-btn",onClick:function(){return H(B)},loading:V,children:"\u53d1\u9001"})]})]})}export{_ as default};
